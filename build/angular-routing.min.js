/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
var dotjem;(function(t,e,r,n){"use strict";function o(t,e){return y(new(y(function(){},{prototype:t})),e)}function a(t){return v(t)?t:t.$fullname||t.fullname}function i(t){if(g(t))return function(e,r){return e.invoke(t,t,r)};if(b(t)){var e=t[t.length-1];return function(r,n){return r.invoke(t,e,n)}}return null}function u(t,e,r){var n=x(t||{});return n.$all=x(t||{}),n.$path=x(e||{}),n.$search=x(r||{}),n}function c(t,e){var r=[];return w(t,function(t,e){r.push(s(e,!0)+(t===!0?"":"="+s(t,!0)))}),r.length?e+r.join("&"):""}function s(t,e){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,e?"%20":"+")}function l(){function t(t){var e=null;return function(n,o){return null===e&&(e=t?v(t)?function(e,n){var o=r(t,n.params);e.path(o).search(n.params).replace()}:function(e,r){e.url(t(r.pathParams,e.path(),e.search())).replace()}:function(){}),e(n,o)}}function e(t,e,r){var n;if(r&&(n=r.trim(),"{"===n[0]&&"}"===n[n.length-1]||"["===n[0]&&"]"===n[n.length-1]))try{r=angular.fromJson(n)}catch(o){}return{name:t,converter:function(){return p[e](r)}}}function r(t,r){var n="",o=0;return w(i(t),function(a){var i=function(t){return""+t},u=e(a.name,a.converter,a.args).converter();!g(u)&&d(u.format)&&(i=u.format),n+=t.slice(o,a.index)+"/"+i(r[a.name]),o=a.lastIndex,delete r[a.name]}),n+=t.substr(o)}function a(t){return t.replace(b,"\\$&")}function i(t){var e,r=[];if(null===t)return r;for(;null!==(e=O.exec(t));)r.push({name:e[4]||e[11],catchAll:"*"===(e[3]||e[10]),converter:e[7]||"",args:e[9],index:e.index,lastIndex:O.lastIndex});return r}function u(t){var r="^",n="",o=[],u=0,c="",s={};return null===t?{name:null,params:s}:"/"===t?{exp:RegExp("^[/]?$",c),segments:[],name:n,params:s}:(w(i(t),function(i,c){var l="";r+=a(t.slice(u,i.index)),r+=i.catchAll?"/(.*)":"/([^\\/]*)",""!==i.converter&&(l=":"+i.converter),n+=t.slice(u,i.index)+"/$"+c+l,s[i.name]={id:c,converter:i.converter},o.push(e(i.name,i.converter,i.args)),u=i.lastIndex}),r+=a(t.substr(u)),n+=t.substr(u),m||(n=n.toLowerCase(),c+="i"),"/"===r[r.length-1]&&(r=r.substr(0,r.length-1)),{exp:RegExp(r+"/?$",c),segments:o,name:n,params:s})}function s(t,e){return null==t?function(){}:function(t){var r,o=t.match(e.exp),a={};return o&&(r=!1,w(e.segments,function(t,e){var n,i,u;r||(n=o[e+1],u=t.converter(),!g(u)&&d(u.parse)&&(u=u.parse),i=u(n),d(i.accept)?(i.accept||(r=!0),a[t.name]=i.value):(i||(r=!0),a[t.name]=n))}),!r)?a:n}}var l=this,f={},p={},h={},m=!0;this.convert=function(t,e){return p[t]=e,l},this.when=function(e,r){var n=u(e);return f[n.name]={self:y({reloadOnSearch:!0},r),redirect:t(r.redirectTo),match:s(e,n),params:n.params,path:e},{convert:l.convert,when:l.when,otherwise:l.otherwise,decorate:l.decorate,ignoreCase:l.ignoreCase,matchCase:l.matchCase,$route:{name:n.name,params:x(n.params),route:e}}},this.otherwise=function(t){return l.when(null,t),l},this.decorate=function(t,e){return h[t]=e,l},this.ignoreCase=function(){return m=!1,l},this.matchCase=function(){return m=!0,l};var b=/[-\/\\^$*+?.()|[\]{}]/g,O=RegExp("/((:(\\*?)(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\*?)(\\w+)\\}))","g");this.convert("num",function(){return{parse:function(t){var e=!isNaN(t);return{accept:e,value:e?Number(t):0}},format:function(t){if(isNaN(t))throw Error(C.invalidNumericValue);return""+t}}}),this.convert("regex",function(t){var e,r,n="";if($(t)&&d(t.exp))e=t.exp,d(t.flags)&&(n=t.flags);else{if(!(v(t)&&t.length>0))throw Error(C.regexConverterNotValid);e=t}return r=RegExp(e,n),{parse:function(t){var e=r.test(t);return{accept:e,value:e?r.exec(t):null}},format:function(t){var e=""+t,n=r.test(e);if(!n)throw Error(C.valueCouldNotBeMatchedByRegex);return e}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams",function(t,e,a,i,u){function s(t,e,r){var n=o(t,{self:o(t.self,{params:y({},r,e),searchParams:r,pathParams:e})});return n}function l(t){var r,n;return w(f,function(o){!n&&(r=o.match(t))&&(n=s(o,r,e.search()))}),n||f[null]&&s(f[null],{},{})}function p(){var r=l(e.path()),o=m.current,c=r?r.self:n;if(!d&&c&&o&&angular.equals(c.pathParams,o.pathParams)&&!c.reloadOnSearch)o.params=c.params,o.searchParams=c.searchParams,o.pathParams=c.pathParams,x(c.params,u),t.$broadcast("$routeUpdate",o);else if(r||o){d=!1;var s=t.$broadcast("$routeChangeStart",c,o);if(!s.defaultPrevented){m.current=c,r&&r.redirect(e,c);var f=a.when(c);c&&w(h,function(t){f=f.then(function(){var e=i.invoke(t,c,{$next:c});return a.when(e)})}),f.then(function(){c===m.current&&(r&&angular.copy(c.params,u),t.$broadcast("$routeChangeSuccess",c,o))},function(e){c===m.current&&t.$broadcast("$routeChangeError",c,o,e)})}}}var d=!1,m={routes:f,reload:function(){d=!0,t.$evalAsync(p)},change:function(t){var n=t.params||{},o=r(t.route,n),a=e.path(o).search(n||{});t.replace&&a.replace()},format:function(t,e){var e=e||{};return r(t,e)+c(e,"?")}};return t.$on("$locationChangeSuccess",p),m}]}function f(){function t(t){var e={handler:{}};return d(t.to)&&(e.to=t.to),d(t.from)&&(e.from=t.from),d(t.handler)&&(e.handler=t.handler),d(t.before)&&m(e.handler.before)&&(e.handler.before=t.before),d(t.between)&&m(e.handler.between)&&(e.handler.between=t.between),d(t.after)&&m(e.handler.after)&&(e.handler.after=t.after),e}function e(t,e){var n=r(t),o=r(e);if(!n||!o){if(n)throw Error("Invalid transition - to: '"+e+"'.");if(o)throw Error("Invalid transition - from: '"+t+"'.");throw Error("Invalid transition - from: '"+t+"', to: '"+e+"'.")}}function r(t){return"*"===t||u.test(t)?!0:!1}function n(t){for(var e=o,r=t.split("."),n="root"===r[0]?1:0;r.length>n;n++)r[n]in e.children||(e.children[r[n]]={children:{},targets:{}}),e=e.children[r[n]];return e}var o={children:{},targets:{}},u=/^\w+(\.\w+)*(\.[*])?$/;this.onEnter=function(e,r){if($(r)){var n=t(r);this.transition(n.from||"*",e,n.handler)}else(g(r)||b(r))&&this.transition("*",e,r)},this.onExit=function(e,r){if($(r)){var n=t(r);this.transition(e,n.to||"*",n.handler)}else(g(r)||b(r))&&this.transition(e,"*",r)},this.transition=function(t,r,o){var u,c=this;if(b(t))w(t,function(t){c.transition(t,r,o)});else if(b(r))w(r,function(e){c.transition(t,e,o)});else{if(t=a(t),r=a(r),r===t&&-1===r.indexOf("*"))return this;e(t,r),i(o)&&(o={between:o}),u=n(t),r in u.targets||(u.targets[r]=[]),o.name=t+" -> "+r,u.targets[r].push(o)}return this},this.$get=["$q","$injector",function(t,e){function r(t,r){function n(n,o){var a;w(u,function(u){d(a=n(u))&&i(a)(e,{$to:r,$from:t,$transition:o})})}var o=s(a(t)),u=c(o,a(r));return{before:function(t){n(function(t){return t.before},t)},between:function(t){n(function(t){return t.between},t)},after:function(t){n(function(t){return t.after},t)}}}function n(t){return"root"===t[0]&&t.splice(0,1),t}function u(t,e){for(var r,o,a=n(t.split(".")).reverse(),i=n(e.split(".")).reverse();;){if(r=a.pop(),o=i.pop(),"*"===o||"*"===r)return!0;if(r!==o)return!1;if(!d(r)||!d(o))return!0}return!0}function c(t,e){var r=[];return w(t,function(t){w(t.targets,function(t,n){u(n,e)&&w(t,function(t){r.push(t)})})}),r}function s(t){var e=o,r=t.split("."),n=[],a="root"===r[0]?1:0;do{if("*"in e.children&&n.push(e.children["*"]),!(r[a]in e.children))break;e=e.children[r[a]],n.push(e)}while(a++<r.length);return n}var l={root:o,find:r};return l}]}function p(){var t=RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))","i");this.$get=["$http","$q","$injector","$templateCache",function(e,r,n,o){function a(t){return e.get(t,{cache:o}).then(function(t){return t.data})}function i(t){return r.when(n.invoke(t))}function u(t){if(d(t.url))return a(t.url);if(d(t.fn))return i(t.fn);if(d(t.html))return r.when(t.html);throw Error("Object must define url, fn or html.")}var c={get:function(e){if(v(e))return t.test(e)?a(e):r.when(e);if(g(e)||b(e))return i(e);if($(e))return u(e);throw Error("Template must be either an url as string, function or a object defining either url, fn or html.")}};return c}]}function h(){this.$get=["$rootScope","$q","$template",function(t,e,r){function n(t){return $(t)&&(d(t.template)||d(t.controller)||d(t.locals)||d(t.sticky))}function o(t){if("undefined"===t)throw Error("Must define a view name.")}function a(e){t.$broadcast("$viewUpdate",e)}function i(e,r){t.$broadcast("$viewRefresh",e,r)}function u(t,e){return e in t&&null!==t[e]}function c(t){return b.completed?(m(t)?w(g,function(t,e){y.clear(e)}):(delete g[t],a(t)),y):b.clear(t)}function s(t,e,c,s,l){var f=e;return n(e)&&(f=e.template,c=e.controller,s=e.locals,l=e.sticky),o(t),b.completed?(u(g,t)||(g[t]={version:-1}),g[t].template=r.get(f),g[t].controller=c,g[t].locals=s,d(l)&&v(l)&&g[t].sticky===l?i(t,{$locals:s,sticky:l}):(g[t].version++,g[t].sticky=l,a(t)),y):b.setOrUpdate(t,f,c,s,l)}function l(t,e,i,c){var s=e;return n(e)&&(s=e.template,i=e.controller,c=e.locals),o(t),b.completed?(u(g,t)||(g[t]={template:r.get(s),controller:i,locals:c,version:0},a(t)),y):b.setIfAbsent(t,s,i,c)}function f(t){return m(t)?g:g[t]}function p(t,e){return b.completed?(m(t)?w(g,function(t,r){y.refresh(r,e)}):(e.$locals=g[t]&&g[t].locals,i(t,e)),y):b.refresh(t,e)}function h(){function t(){var t,e={};return t={completed:!1,commit:function(){t.completed||(t.completed=!0,w(e,function(t){t.fn()}))},cancel:function(){t.completed=!0},clear:function(r){return m(r)?(w(g,function(e,r){t.clear(r)}),t):(e[r]={act:"clear",fn:function(){c(r)}},t)},setOrUpdate:function(r,n,a,i,u){return o(r),e[r]={act:"setOrUpdate",fn:function(){s(r,n,a,i,u)}},t},setIfAbsent:function(r,n,a,i){return o(r),u(e,r)&&"clear"!==e[r].act||(e[r]={act:"setIfAbsent",fn:function(){l(r,n,a,i)}}),t},refresh:function(r,n){return m(r)?(w(g,function(e,r){t.refresh(r,n)}),t):(e[r]={act:"refresh",fn:function(){p(r,n)}},t)},get:f}}if(!b.completed)throw Error("Can't start multiple transactions");return b=t()}var g={},b={completed:!0},y={get:f,clear:c,refresh:p,setOrUpdate:s,setIfAbsent:l,beginUpdate:h};return y}]}angular.module("dotjem.routing",[]);var d=angular.isDefined,m=angular.isUndefined,g=angular.isFunction,v=angular.isString,$=angular.isObject,b=angular.isArray,w=angular.forEach,y=angular.extend,x=angular.copy,O=angular.equals;angular.element;var C={routeCannotBeUndefined:"Can not set route to undefined.",valueCouldNotBeMatchedByRegex:"Value could not be matched by the regular expression parameter.",regexConverterNotValid:"The Regular-expression converter was not initialized with a valid object.",invalidNumericValue:"Value was not acceptable for a numeric parameter.",invalidBrowserPathExpression:"Invalid path expression.",expressionOutOfBounds:"Expression out of bounds.",couldNotFindStateForPath:"Could find state for path."};angular.module("dotjem.routing").provider("$route",l).value("$routeParams",{}),angular.module("dotjem.routing").provider("$stateTransition",f);var j=["$routeProvider","$stateTransitionProvider",function(t,e){var r=new _(t,e),n=r.createState("root",{}),o=new R(n);new A,this.state=function(t,e){U.validateName(t);var n=o.lookup(t,1);return n.add(r.createState(t,e,n)),this},this.$get=["$rootScope","$q","$injector","$route","$view","$stateTransition","$location","$scroll","$resolve",function(t,e,r,c,s,l,f,p,h){function m(e){d(e)?v(e)||$(e)?(x=a(e),0!==x.indexOf("root")&&(x="root."+x)):e&&(x=n.fullname):x=O.fullname,t.$evalAsync(function(){g({state:O,params:C.params,fource:x})})}function g(n){if(j=j.next().execute(T.initializeContext(o.lookup(a(n.state)),n.params)).execute(T.createEmitter(l)).execute(T.buildChanges(x)).execute(T.createTransition(g)).execute(function(){x=null}).execute(T.raiseUpdate(t)).execute(T.updateRoute(c,n.updateroute)).execute(T.before()).execute(function(e){t.$broadcast("$stateChangeStart",e.toState,C.current).defaultPrevented&&e.abort()}).execute(T.beginTransaction(s)),!j.ended){var u,f=!1,m={},$=e.when("");return w(j.changed.array,function(t){$=$.then(function(){return(f=t.isChanged||f)&&h.clear(t.state.resolve),h.all(t.state.resolve,m,{$to:j.toState,$from:C.current})}).then(function(e){m=y({},m,e),u=t.state.scrollTo,w(t.state.views,function(e,n){var o,a;(o=e.sticky)&&((a=i(o))?o=a(r,{$to:j.toState,$from:C.current}):v(o)||(o=t.state.fullname)),f||e.force||d(o)?j.transaction.setOrUpdate(n,e.template,e.controller,m,o):j.transaction.setIfAbsent(n,e.template,e.controller,m)})})}),$.then(function(){j=j.execute(T.between(t)).execute(function(e){O=e.to;var r=C.current;C.params=e.params,C.current=e.toState,e.transaction.commit(),t.$broadcast("$stateChangeSuccess",e.toState,r)}).execute(T.after(p,u)).complete()},function(e){j=j.execute(function(r){t.$broadcast("$stateChangeError",r.toState,C.current,e),r.abort()})})}}var b=new k(c),x=null,O=n,C={root:n,current:y(n.self,{$params:u()}),params:u(),"goto":function(t,e){g({state:t,params:u(e),updateroute:!0})},lookup:function(t){return o.resolve(O,t)},reload:m,url:function(t,e){return t=d(t)?o.lookup(a(t)):O,b.buildUrl(C.current,t,e)},is:function(t){return O.is(a(t))},isActive:function(t){return O.isActive(a(t))}},j=new N(C,n).complete();return t.$on("$routeChangeSuccess",function(){var t=c.current;t?t.state&&g({state:t.state,params:u(t.params,t.pathParams,t.searchParams)}):g({state:n,params:u()})}),t.$on("$routeUpdate",function(){var e=c.current,r=u(e.params,e.pathParams,e.searchParams);C.params=r,C.current.$params=r,t.$broadcast("$stateUpdate",C.current)}),C}]}];angular.module("dotjem.routing").provider("$state",j);var E=[function(){this.$get=["$q","$injector",function(t,e){var r={},n={};return r.push=function(t,e){n[t]=e},r.clear=function(t){m(t)&&(n={}),v(t)?delete n[t]:$(t)?angular.forEach(t,function(t,e){r.clear(e)}):b(t)&&angular.forEach(t,function(t){r.clear(t)})},r.all=function(r,o,a){var u=[],c=[],s=t.defer();return angular.forEach(r,function(t,r){var l;c.push(r);try{r in n||(v(t)?n[r]=angular.isString(t):null!=(l=i(t))&&(n[r]=l(e,y({},o,a)))),u.push(n[r])}catch(f){s.reject("Could not resolve "+r)}}),t.all(u).then(function(t){var e={};angular.forEach(t,function(t,r){e[c[r]]=t}),s.resolve(e)},function(t){s.reject(t)}),s.promise},r}]}];angular.module("dotjem.routing").provider("$resolve",E),angular.module("dotjem.routing").provider("$template",p),angular.module("dotjem.routing").provider("$view",h);var S=[function(){this.$get=["$window","$rootScope","$anchorScroll","$injector",function(t,e,r,o){function a(r){return u.$current=r,"top"===r?(t.scrollTo(0,0),n):(e.$broadcast("$scrollPositionChanged",r),n)}var u=function(t){var e;m(t)?r():v(t)?a(t):null!==(e=i(t))&&a(e(o))};return u.$current="top",u}]}];angular.module("dotjem.routing").provider("$scroll",S);var P=function(){function t(t,e,r,n){this._name=t,this._fullname=e,this._parent=n,this._children={},this._self=r,this._self.$fullname=e,this._reloadOnOptional=!d(r.reloadOnSearch)||r.reloadOnSearch,this._scrollTo=this._self.scrollTo||n&&n.scrollTo||"top"}return Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullname",{get:function(){return this._fullname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloadOnOptional",{get:function(){return this._reloadOnOptional},set:function(t){this._reloadOnOptional=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"self",{get:function(){return x(this._self)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"route",{get:function(){return this._route},set:function(t){if(m(t))throw Error(C.routeCannotBeUndefined);this._route=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return null===this.parent?this:this._parent.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollTo",{get:function(){return this._scrollTo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return this.self.views},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolve",{get:function(){return this.self.resolve},enumerable:!0,configurable:!0}),t.prototype.add=function(t){return this._children[t.name]=t,this},t.prototype.resolveRoute=function(){return d(this.route)?this.route.route:d(this.parent)?this.parent.resolveRoute():""},t.prototype.is=function(t){return this.fullname===t||this.fullname==="root."+t},t.prototype.isActive=function(t){return this.is(t)?!0:this.parent&&this.parent.isActive(t)||!1},t}(),R=function(){function t(t){this.root=t,this.nameRegex=RegExp("^\\w+(\\.\\w+)+$"),this.siblingRegex=RegExp("^\\$node\\(([-+]?\\d+)\\)$"),this.indexRegex=RegExp("^\\[(-?\\d+)\\]$")}return t.prototype.lookup=function(t,e){for(var r=this.root,n=t.split("."),o="root"===n[0]?1:0,e=d(e)?e:0;n.length-e>o;o++){if(!(n[o]in r.children))throw Error("Could not locate '"+n[o]+"' under '"+r.fullname+"'.");r=r.children[n[o]]}return r},t.prototype.resolve=function(t,e){var r,o=this,a=this.siblingRegex.exec(e),i=t;if(a?i=this.selectSibling(Number(a[1]),i):this.nameRegex.test(e)?i=this.lookup(e):(r=e.split("/"),w(r,function(e){i=o.select(t,e,i)})),i===this.root)throw Error(C.expressionOutOfBounds);return i&&x(i.self)||n},t.prototype.selectSibling=function(t,e){var r=[],n=0;for(w(e.parent.children,function(t){r.push(t),e.fullname===t.fullname&&(n=r.length-1)});0>t;)t+=r.length;return t=(n+t)%r.length,r[t]},t.prototype.select=function(t,e,r){if("."===e){if(t!==r)throw Error(C.invalidBrowserPathExpression);return r}if(".."===e){if(m(r.parent))throw Error(C.expressionOutOfBounds);return r.parent}if(""===e){if(t!==r)throw Error(C.invalidBrowserPathExpression);return this.root}var n=this.indexRegex.exec(e);if(n){var o=Number(n[1]),a=[];if(w(r.children,function(t){a.push(t)}),Math.abs(o)>=a.length)throw Error(C.expressionOutOfBounds);return 0>o?a[a.length+o]:a[o]}if(e in r.children)return r.children[e];throw Error(C.couldNotFindStateForPath)},t}(),A=function(){function t(){}return t.prototype.buildStateArray=function(t,e){function r(){var t={};return o.route&&w(o.route.params,function(r,n){t[n]=e[n]}),t}var n=[],o=t;do n.push({state:o,params:r()});while(o=o.parent);return n},t.prototype.compare=function(t,e,r,n,o){for(var a,i,u=this.buildStateArray(t,r||{}),c=this.buildStateArray(e,n),s=Math.max(u.length,c.length),l=!1,f=!O(r,n),p=0;s>p;p++)a=u[u.length-p-1],i=c[c.length-p-1],m(i)?c[0].isChanged=l=!0:i.isChanged=m(a)||o===i.state.fullname||i.state.fullname!==a.state.fullname||!O(i.params,a.params)?l=!0:!1;return l=l||c[0].state.reloadOnOptional&&f,{array:c.reverse(),stateChanges:l,paramChanges:f}},t}(),_=function(){function t(t,e){this.routes=t,this.transitions=e}return t.prototype.createRoute=function(t,e,r,n){var o=e||"";return""!==o&&"/"===o[o.length-1]&&(o=o.substr(0,o.length-1)),"/"!==t[0]&&""!==t&&(o+="/"),o+=t,this.routes.when(o,{state:r,reloadOnSearch:n})},t.prototype.createState=function(t,e,r){var n=this,o=t.split(".").pop();d(r)&&(t=r.fullname+"."+o);var a=new P(o,t,e,r);return a.reloadOnOptional=!d(e.reloadOnSearch)||e.reloadOnSearch,d(e.route)&&(a.route=this.createRoute(e.route,r.resolveRoute(),a.fullname,a.reloadOnOptional).$route),d(e.onEnter)&&this.transitions.onEnter(a.fullname,e.onEnter),d(e.onExit)&&this.transitions.onExit(a.fullname,e.onExit),d(e.children)&&w(e.children,function(t,e){a.add(n.createState(a.fullname+"."+e,t,a))}),a},t}(),U=function(){function t(){}return t.nameValidation=/^\w+(\.\w+)*?$/,t.validateName=function(e){if(!t.nameValidation.test(e))throw Error("Invalid name: '"+e+"'.")},t}(),k=function(){function t(t){this.route=t}return t.prototype.buildUrl=function(t,e,r){var n=t;if(!e.route)throw Error("Can't build url for a state that doesn't have a url defined.");var o={},a=n&&n.$params.$all||{};return w(e.route.params,function(t,e){e in a&&(o[e]=a[e])}),this.route.format(e.route.route,y(o,r||{}))},t}(),N=function(){function t(t,e){this.previous={},this.properties={},this.aborted=!1,this.completed=!1,this.properties={},this._$state=t,this.to=e}return Object.defineProperty(t.prototype,"$state",{get:function(){return this._$state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"to",{get:function(){return this.properties.to},set:function(t){this.properties.to=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"from",{get:function(){return this.properties.from},set:function(t){this.properties.from=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this.properties.params},set:function(t){this.properties.params=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emit",{get:function(){return this.properties.emit},set:function(t){this.properties.emit=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changed",{get:function(){return this.properties.changed},set:function(t){this.properties.changed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toState",{get:function(){return this.properties.toState},set:function(t){this.properties.toState=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transition",{get:function(){return this.properties.transition},set:function(t){this.properties.transition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transaction",{get:function(){return this.properties.transaction},set:function(t){this.properties.transaction=t},enumerable:!0,configurable:!0}),t.prototype.next=function(){this.ended||this.abort();var e=new t(this.$state);return e.previous=this,e.from=this.to,e},t.prototype.execute=function(t){return this.ended?this:(t(this),this.aborted?this.previous:this)},Object.defineProperty(t.prototype,"ended",{get:function(){return this.aborted||this.completed},enumerable:!0,configurable:!0}),t.prototype.complete=function(){return this.completed=!0,this},t.prototype.abort=function(){return this.aborted=!0,this.transaction&&!this.transaction.completed&&this.transaction.cancel(),this},t}(),T={initializeContext:function(t,e){return function(r){r.to=t,r.params=e,r.toState=y({},t.self,{$params:e})}},createEmitter:function(t){return function(e){e.emit=t.find(e.$state.current,e.toState)}},buildChanges:function(t){return function(e){e.changed=(new A).compare(e.from,e.to,e.$state.params,e.params,t)}},createTransition:function(t){return function(e){var r={canceled:!1,cancel:function(){r.canceled=!0},"goto":function(e,n){r.canceled=!0,t({state:e,params:{all:n},updateroute:!0})}};e.transition=r}},raiseUpdate:function(t){return function(e){var r=e.changed,n=e.$state;r.stateChanges||(r.paramChanges&&(n.params=e.params,n.current.$params=e.params,t.$broadcast("$stateUpdate",n.current)),e.abort())}},updateRoute:function(t,e){return function(r){var n=r.to.route;if(e&&n){var o={},a=r.$state.params.$all;w(n.params,function(t,e){e in a&&(o[e]=a[e])});var i=y(o,r.params.$all);t.change(y({},n,{params:i})),r.abort()}}},before:function(){return function(t){t.emit.before(t.transition),t.transition.canceled&&t.abort()}},between:function(t){return function(e){e.emit.between(e.transition),e.transition.canceled&&(t.$broadcast("$stateChangeAborted",e.toState,e.$state.current),e.abort())}},after:function(t,e){return function(r){r.transition.canceled||(r.transition.cancel=function(){throw Error("Can't cancel transition in after handler")},r.emit.after(r.transition),t(e))}},beginTransaction:function(t){return function(e){e.transaction=t.beginUpdate(),e.transaction.clear()}}},I=["$state","$scroll","$compile","$controller","$view","$animator",function(t,e,r,n,o,a){return{restrict:"ECA",terminal:!0,link:function(t,e,i){function u(){}function c(){f&&(f.$destroy(),f=null)}function s(t){t?v.leave(e.contents(),e):e.html(""),c()}function l(a){var i,u=o.get(p);if(u&&u.template){if(u.version===$)return;$=u.version,i=u.controller,u.template.then(function(o){s(a),a?v.enter(angular.element("<div></div>").html(o).contents(),e):e.html(o);var c,l=r(e.contents());f=t.$new(),i&&(c=x(u.locals),c.$scope=f,i=n(i,c),e.contents().data("$ngControllerController",i)),l(f),f.$emit("$viewContentLoaded"),f.$eval(m)})}else $=-1,s(a)}var f,p=i.jemView||i.name,h=d(i.ngAnimate),m=i.onload||"",v=a(t,i),$=-1;t.$on("$viewChanged",function(t,e){e===p&&l(h)}),t.$on("$viewRefresh",function(t,e,r){e===p&&(g(f.refresh)?f.refresh(r):f.$broadcast("$refresh",e,r))}),t.$on("$stateChangeSuccess",function(){return l(h)}),t.$on("$stateChangeStart",function(){return u(h,!1)}),t.$on("$stateChangeAborted",function(){return u(h,!0)}),l(!1)}}}];angular.module("dotjem.routing").directive("jemView",I);var B=["$scroll","$timeout",function(t,e){return{restrict:"ECA",terminal:!1,link:function(r,n,o){function a(t){t===i&&e(function(){n[0].scrollIntoView()},u)}var i=o.jemAnchor||o.id,u=d(o.delay)?Number(o.delay):1;r.$on("$scrollPositionChanged",function(t,e){a(e)}),a(t.$current)}}}];angular.module("dotjem.routing").directive("jemAnchor",B),angular.module("dotjem.routing").directive("id",B),r.State=P,r.StateBrowser=R,r.StateComparer=A,r.StateFactory=_,r.StateRules=U,r.StateUrlBuilder=k})(window,document,dotjem||(dotjem={}));