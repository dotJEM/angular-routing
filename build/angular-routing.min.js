/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
var dotjem;!function(a,b,c,d){"use strict";function e(a,b){return x(new(x(function(){},{prototype:a})),b)}function f(a){return s(a)?a:a.$fullname||a.fullname}function g(a){if(!u(a))return!1;for(var b=Error("Incorrect injection annotation! Expected an array of strings with the last element as a function"),c=0,d=a.length;d>c;c++)if(d-1>c){if(!s(a[c]))throw b}else if(!r(a[c])&&!s(a[c]))throw b;return!0}function h(a){return g(a)||r(a)}function i(a,b,c){var d=y(a||{});return d.$all=y(a||{}),d.$path=y(b||{}),d.$search=y(c||{}),d}function j(a,b){var c=[];return w(a,function(a,b){c.push(k(b,!0)+(a===!0?"":"="+k(a,!0)))}),c.length?b+c.join("&"):""}function k(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")}function l(a){return a.replace(C,"\\$&")}function m(){function a(a){var b={handler:{}};return p(a.to)&&(b.to=a.to),p(a.from)&&(b.from=a.from),p(a.handler)&&(b.handler=a.handler),p(a.before)&&q(b.handler.before)&&(b.handler.before=a.before),p(a.between)&&q(b.handler.between)&&(b.handler.between=a.between),p(a.after)&&q(b.handler.after)&&(b.handler.after=a.after),b}function b(a,b){var c=P.validateTarget(a),d=P.validateTarget(b);if(!c||!d){if(c)throw new Error("Invalid transition - to: '"+b+"'.");if(d)throw new Error("Invalid transition - from: '"+a+"'.");throw new Error("Invalid transition - from: '"+a+"', to: '"+b+"'.")}}function c(a){for(var b=d,c=a.split("."),e=c[0]===B?1:0;e<c.length;e++)c[e]in b.children||(b.children[c[e]]={children:{},targets:{}}),b=b.children[c[e]];return b}var d={children:{},targets:{}};this.onEnter=function(b,c){if(h(c))this.transition("*",b,c);else if(t(c)){var d=a(c);this.transition(d.from||"*",b,d.handler)}},this.onExit=function(b,c){if(h(c))this.transition(b,"*",c);else if(t(c)){var d=a(c);this.transition(b,d.to||"*",d.handler)}},this.transition=function(a,d,e){var g,i=this;if(u(a))w(a,function(a){i.transition(a,d,e)});else if(u(d))w(d,function(b){i.transition(a,b,e)});else{if(a=f(a),d=f(d),d===a&&-1===d.indexOf("*"))return this;b(a,d),h(e)&&(e={between:e}),g=c(a),d in g.targets||(g.targets[d]=[]),e.name=a+" -> "+d,g.targets[d].push(e)}return this},this.$get=["$q","$inject",function(a,b){function c(a,c){function d(d,e,f){var h;w(g,function(g){p(h=d(g))&&b.create(h)({$to:c,$from:a,$transition:e,$view:f})})}var e=i(f(a)),g=h(e,f(c));return{before:function(a,b){d(function(a){return a.before},a,b)},between:function(a,b){d(function(a){return a.between},a,b)},after:function(a,b){d(function(a){return a.after},a,b)}}}function e(a){return a[0]===B&&a.splice(0,1),a}function g(a,b){for(var c,d,f=e(a.split(".")).reverse(),g=e(b.split(".")).reverse();;){if(c=f.pop(),d=g.pop(),"*"===d||"*"===c)return!0;if(c!==d)return!1;if(!p(c)||!p(d))return!0}}function h(a,b){var c=[];return w(a,function(a){w(a.targets,function(a,d){g(d,b)&&w(a,function(a){c.push(a)})})}),c}function i(a){var b=d,c=a.split("."),e=[],f=c[0]===B?1:0;do{if("*"in b.children&&e.push(b.children["*"]),!(c[f]in b.children))break;b=b.children[c[f]],e.push(b)}while(f++<c.length);return e}var j={root:d,find:c};return j}]}function n(){var a=new RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))$","i");this.$get=["$http","$q","$injector","$templateCache",function(b,c,d,e){function f(a){return b.get(a,{cache:e}).then(function(a){return a.data})}function g(a){return c.when(d.invoke(a))}function h(a){if(p(a.url))return f(a.url);if(p(a.fn))return g(a.fn);if(p(a.html))return c.when(a.html);throw new Error("Object must define url, fn or html.")}var i=function(b){if(s(b))return a.test(b)?f(b):c.when(b);if(r(b)||u(b))return g(b);if(t(b))return h(b);throw new Error("Template must be either an url as string, function or a object defining either url, fn or html.")},j=function(a){return j.fn(a)};return j.fn=i,j}]}function o(){this.$get=["$rootScope","$q","$template",function(a,b,c){function d(a){if(q(a))throw new Error("Must define a view name.")}function e(b){a.$broadcast(E.VIEW_UPDATE,b)}function f(b,c){a.$broadcast(E.VIEW_REFRESH,b,c)}function g(b,c){a.$broadcast(E.VIEW_PREP,b,c)}function h(a,b){return b in a&&null!==a[b]}function i(a){return u.completed?(q(a)?w(t,function(a,b){v.clear(b)}):(delete t[a],e(a)),v):u.clear(a)}function j(a,b){var g=b.template,i=b.controller,j=b.locals,l=b.sticky;return d(a),u.completed?(h(t,a)||(t[a]={version:-1}),t[a].template=c(g),t[a].controller=i,t[a].locals=j,k(a,l)?f(a,{$locals:j,sticky:l}):(t[a].version++,t[a].sticky=l,e(a)),v):u.update(a,b)}function k(a,b){return p(b)&&s(b)&&a in t&&t[a].sticky===b}function l(a,b){var f=b.template,g=b.controller,i=b.locals,j=b.sticky;return d(a),u.completed?(h(t,a)||(t[a]={template:c(f),controller:g,locals:i,sticky:j,version:0},e(a)),v):u.create(a,b)}function m(a){return y(q(a)?t:t[a])}function n(a,b){return u.completed?(q(a)?w(t,function(a,c){v.refresh(c,b)}):(b.$locals=t[a]&&t[a].locals,f(a,b)),v):u.refresh(a,b)}function o(a,b){var c=a in t,d=k(a,b.args.sticky);switch(b.act){case"clear":return"unload";case"update":return d?"refresh":"update";case"create":return c?"keep":"load";case"refresh":return"refresh"}return"invalid"}function r(){function a(){var a,b={};return a={completed:!1,pending:function(a){if(p(a)){var c=b[a];return{action:o(a,c),args:c.args}}var d={};return w(b,function(a,b){d[b]={action:o(b,a)}}),d},commit:function(){return a.completed?a:(a.completed=!0,w(b,function(a){a.fn()}),b={},a)},cancel:function(){return g(name,{type:"cancel"}),a.completed=!0,a},clear:function(c){return q(c)?(w(t,function(b,c){a.clear(c)}),a):(b[c]={act:"clear",args:{name:c},fn:function(){i(c)}},a)},prepUpdate:function(b,c){return g(b,{type:"update"}),function(d){return c.locals=x({},c.locals,d),a.update(b,c),a}},prepCreate:function(b,c){return g(b,{type:"create"}),function(d){return c.locals=x({},c.locals,d),a.create(b,c),a}},update:function(c,e){return d(c),b[c]={act:"update",args:e,fn:function(){j(c,e)}},a},create:function(c,e){return d(c),h(b,c)&&"clear"!==b[c].act||(b[c]={act:"create",args:e,fn:function(){l(c,e)}}),a},refresh:function(c,d){return q(c)?(w(t,function(b,c){a.refresh(c,d)}),a):(b[c]={act:"refresh",args:{name:c,data:d},fn:function(){n(c,d)}},a)},get:m}}if(!u.completed)throw new Error("Can't start multiple transactions");return u=a()}var t={},u={completed:!0},v={get:m,clear:i,refresh:n,update:j,create:l,beginUpdate:r};return v}]}angular.module("dotjem.routing",[]);var p=angular.isDefined,q=angular.isUndefined,r=angular.isFunction,s=angular.isString,t=angular.isObject,u=angular.isArray,v=function(a){return"boolean"==typeof a},w=angular.forEach,x=angular.extend,y=angular.copy,z=angular.equals,A=(angular.element,angular.noop),B="$root",C=/[-\/\\^$*+?.()|[\]{}]/g,D={routeCannotBeUndefined:"Can not set route to undefined.",valueCouldNotBeMatchedByRegex:"Value could not be matched by the regular expression parameter.",regexConverterNotValid:"The Regular-expression converter was not initialized with a valid object.",invalidNumericValue:"Value was not acceptable for a numeric parameter.",invalidBrowserPathExpression:"Invalid path expression.",expressionOutOfBounds:"Expression out of bounds.",couldNotFindStateForPath:"Could find state for path."},E={LOCATION_CHANGE:"$locationChangeSuccess",ROUTE_UPDATE:"$routeUpdate",ROUTE_CHANGE_START:"$routeChangeStart",ROUTE_CHANGE_SUCCESS:"$routeChangeSuccess",ROUTE_CHANGE_ERROR:"$routeChangeError",STATE_UPDATE:"$stateUpdate",STATE_CHANGE_START:"$stateChangeStart",STATE_CHANGE_SUCCESS:"$stateChangeSuccess",STATE_CHANGE_ERROR:"$stateChangeError",VIEW_UPDATE:"$viewUpdate",VIEW_REFRESH:"$viewRefresh",VIEW_PREP:"$viewPrep"},F=["$locationProvider",function(a){function b(a){var b=null;return function(c,d){return null===b&&(b=a?s(a)?function(b,c){var d=f(a,c.params);b.path(d).search(c.params).replace()}:function(b,c){b.url(a(c.pathParams,b.path(),b.search())).replace()}:A),b(c,d)}}function c(a,b,c){var d;if(c&&(d=c.trim(),"{"===d[0]&&"}"===d[d.length-1]||"["===d[0]&&"]"===d[d.length-1]))try{c=angular.fromJson(d)}catch(e){}return{name:a,converter:function(){return n[b](c)}}}function f(a,b){var d="",e=0;return w(g(a),function(f){var g=function(a){return a.toString()},h=c(f.name,f.converter,f.args).converter(),i=b[f.name];if(q(i))throw Error("Could not find parameter '"+f.name+"' when building url for route '"+a+"', ensure that all required parameters are provided.");!r(h)&&p(h.format)&&(g=h.format),d+=a.slice(e,f.index)+"/"+g(i),e=f.lastIndex,delete b[f.name]}),d+=a.substr(e)}function g(a){var b,c=[];if(null===a)return c;for(;null!==(b=v.exec(a));)c.push({name:b[4]||b[11],catchAll:"*"===(b[3]||b[10]),converter:b[7]||"",args:b[9],index:b.index,lastIndex:v.lastIndex});return c}function h(a){var b="^",d="",e=[],f=0,h="",i={};return null===a?{name:null,params:i}:"/"===a?{exp:new RegExp("^[/]?$",h),segments:[],name:d,params:i}:(w(g(a),function(g,h){var j="";b+=l(a.slice(f,g.index)),b+=g.catchAll?"/(.*)":"/([^\\/]*)",""!==g.converter&&(j=":"+g.converter),d+=a.slice(f,g.index)+"/$"+h+j,i[g.name]={id:h,converter:g.converter},e.push(c(g.name,g.converter,g.args)),f=g.lastIndex}),b+=l(a.substr(f)),d+=a.substr(f),u||(d=d.toLowerCase(),h+="i"),"/"===b[b.length-1]&&(b=b.substr(0,b.length-1)),{exp:new RegExp(b+"/?$",h),segments:e,name:d,params:i})}function i(a,b){return null==a?A:function(a){var c,d=a.match(b.exp),e={};return d&&(c=!1,w(b.segments,function(a,b){var f,g,h;c||(f=d[b+1],h=a.converter(),!r(h)&&p(h.parse)&&(h=h.parse),g=h(f),p(g.accept)?(g.accept||(c=!0),e[a.name]=g.value):(g||(c=!0),e[a.name]=f))}),!c)?e:void 0}}var k=this,m={},n={},o={},u=!0;this.convert=function(a,b){return n[a]=b,k},this.when=function(a,c){var d=h(a);return m[d.name]={self:x({reloadOnSearch:!0},c),redirect:b(c.redirectTo),match:i(a,d),params:d.params,path:a},{convert:k.convert,when:k.when,otherwise:k.otherwise,decorate:k.decorate,ignoreCase:k.ignoreCase,matchCase:k.matchCase,$route:{name:d.name,params:y(d.params),route:a}}},this.otherwise=function(a){return k.when(null,a),k},this.decorate=function(a,b){return o[a]=b,k},this.ignoreCase=function(){return u=!1,k},this.matchCase=function(){return u=!0,k};var v=new RegExp("/((:(\\*?)(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\*?)(\\w+)\\}))","g");this.convert("num",function(){return{parse:function(a){var b=!isNaN(a);return{accept:b,value:b?Number(a):0}},format:function(a){if(isNaN(a))throw new Error(D.invalidNumericValue);return a.toString()}}}),this.convert("regex",function(a){var b,c,d="";if(t(a)&&p(a.exp))b=a.exp,p(a.flags)&&(d=a.flags);else{if(!(s(a)&&a.length>0))throw Error(D.regexConverterNotValid);b=a}return c=new RegExp(b,d),{parse:function(a){var b=c.test(a);return{accept:b,value:b?c.exec(a):null}},format:function(a){var b=a.toString(),d=c.test(b);if(!d)throw Error(D.valueCouldNotBeMatchedByRegex);return b}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams","$browser",function(b,c,g,h,i,k){function l(a,b,c){var d=e(a,{self:e(a.self,{params:x({},c,b),searchParams:c,pathParams:b})});return d}function n(a){var b,d;return w(m,function(e){!d&&(b=e.match(a))&&(d=l(e,b,c.search()))}),d||m[null]&&l(m[null],{},{})}function q(){var a=n(c.path()),e=s.current,f=a?a.self:d;if(!r&&f&&e&&angular.equals(f.pathParams,e.pathParams)&&!f.reloadOnSearch)e.params=f.params,e.searchParams=f.searchParams,e.pathParams=f.pathParams,y(f.params,i),b.$broadcast(E.ROUTE_UPDATE,e);else if(a||e){r=!1;var j=b.$broadcast(E.ROUTE_CHANGE_START,f,e);if(!j.defaultPrevented){s.current=f,a&&a.redirect(c,f);var k=g.when(f);f&&w(o,function(a){k=k.then(function(){var b=h.invoke(a,f,{$next:f});return g.when(b)})}),k.then(function(){f===s.current&&(a&&angular.copy(f.params,i),b.$broadcast(E.ROUTE_CHANGE_SUCCESS,f,e))},function(a){f===s.current&&b.$broadcast(E.ROUTE_CHANGE_ERROR,f,e,a)})}}}var r=!1,s={routes:m,html5Mode:function(){return a.html5Mode()},hashPrefix:function(){return a.hashPrefix()},reload:function(){r=!0,b.$evalAsync(q)},change:function(a){var b=a.params||{},d=f(a.route,b),e=c.path(d).search(b);a.replace&&e.replace()},format:function(b,c,d){var e;return c=c||{},d=p(d)?d:!0,e=f(b,c)+j(c,"?"),a.html5Mode()&&d&&(e=(k.baseHref()+e).replace(/\/\//g,"/")),e}};return b.$on(E.LOCATION_CHANGE,q),s}]}];angular.module("dotjem.routing").provider("$route",F).value("$routeParams",{}),angular.module("dotjem.routing").provider("$stateTransition",m);var G=["$routeProvider","$stateTransitionProvider",function(a,b){var c=new O(a,b),e=c.createState(B,{}),g=new M(e);this.state=function(a,b){P.validateName(a);var d=g.lookup(a,1);return d.add(c.createState(a,b,d)),this},this.$get=["$rootScope","$q","$inject","$route","$view","$stateTransition","$location","$scroll","$resolve",function(a,b,c,h,j,k,l,m,n){function o(b){p(b)?s(b)||t(b)?(u=f(b),0!==u.indexOf(B)&&(u=B+"."+u)):b&&(u=e.fullname):u=y.fullname,a.$evalAsync(function(){q({state:y,params:z.params,fource:u})})}function q(d){var e,i,l=!1;C.ended||C.abort(),e=C=A.next(function(a){A=a}),e=e.execute(R.initializeContext(f(d.state),d.params,g)).execute(function(a){a.promise=b.when(""),a.locals={}}).execute(R.createEmitter(k)).execute(R.buildChanges(u)).execute(R.createTransition(q)).execute(function(){u=null}).execute(R.raiseUpdate(a)).execute(R.updateRoute(h,d.updateroute)).execute(R.beginTransaction(j,c)).execute(R.before()).execute(function(b){a.$broadcast(E.STATE_CHANGE_START,b.toState,z.current).defaultPrevented&&b.abort()}),e.ended||(w(e.changed.array,function(a){e.promise=e.promise.then(function(){return(l=l||a.isChanged)&&n.clear(a.state.resolve),n.all(a.state.resolve,A.locals,{$to:e.toState,$from:z.current})}).then(function(b){e.completePrep(a.state.fullname,A.locals=x({},A.locals,b)),i=a.state.scrollTo})}),e.promise.then(function(){e.execute(R.between(a)).execute(function(b){y=b.to;var c=z.current;z.params=b.params,z.current=b.toState,b.transaction.commit(),a.$broadcast(E.STATE_CHANGE_SUCCESS,b.toState,c)}).execute(R.after(m,i)).complete()},function(b){e.execute(function(c){a.$broadcast(E.STATE_CHANGE_ERROR,c.toState,z.current,b),c.abort()})}))}var r=new Q(h),u=null,y=e,z={root:e,current:x(e.self,{$params:i()}),params:i(),"goto":function(a,b){q({state:a,params:i(b),updateroute:!0})},lookup:function(a){return g.resolve(y,a,!0)},reload:o,url:function(a,b,c){var e=y;return 0===arguments.length?r.buildUrl(z.current,e,d,d):1===arguments.length?v(a)?r.buildUrl(z.current,e,d,a):(e=g.resolve(y,f(a),!1),r.buildUrl(z.current,e,d,d)):(p(a)&&(e=g.resolve(y,f(a),!1)),v(b)?r.buildUrl(z.current,e,d,b):r.buildUrl(z.current,e,b,c))},is:function(a){return y.is(f(a))},isActive:function(a){return y.isActive(f(a))}};a.$on(E.ROUTE_CHANGE_SUCCESS,function(){var a=h.current;a?a.state&&q({state:a.state,params:i(a.params,a.pathParams,a.searchParams)}):q({state:e,params:i()})}),a.$on(E.ROUTE_UPDATE,function(){var b=h.current,c=i(b.params,b.pathParams,b.searchParams);z.params=c,z.current.$params=c,a.$broadcast(E.STATE_UPDATE,z.current)});var A=new S(z,function(){},e).complete(),C=A;return z}]}];angular.module("dotjem.routing").provider("$state",G);var H=[function(){this.$get=["$q","$inject",function(a,b){var c={},d={};return c.push=function(a,b){d[a]=b},c.clear=function(a){v(a)&&a&&(d={}),s(a)?delete d[a]:t(a)?angular.forEach(a,function(a,b){c.clear(b)}):u(a)&&angular.forEach(a,function(a){c.clear(a)})},c.all=function(c,e,f){var g=[],h=[],i=a.defer();return angular.forEach(c,function(a,c){var j;h.push(c);try{c in d||(s(a)?d[c]=angular.isString(a):(j=b.create(a))&&(d[c]=j(x({},e,f)))),g.push(d[c])}catch(k){i.reject("Could not resolve "+c+", error was: "+k)}}),a.all(g).then(function(a){var b={};angular.forEach(a,function(a,c){b[h[c]]=a}),i.resolve(b)},function(a){i.reject(a)}),i.promise},c}]}];angular.module("dotjem.routing").provider("$resolve",H),angular.module("dotjem.routing").provider("$template",n),angular.module("dotjem.routing").provider("$view",o);var I=[function(){this.$get=["$window","$rootScope","$anchorScroll","$inject",function(a,b,c,d){function e(c){return f.$current=c,"top"===c?void a.scrollTo(0,0):void b.$broadcast("$scrollPositionChanged",c)}var f=function(a){var b;q(a)?c():s(a)?e(a):(b=d.create(a))&&e(b())};return f.$current="top",f}]}];angular.module("dotjem.routing").provider("$scroll",I);var J=[function(){this.$get=["$injector",function(a){function b(b){if(h(b)){var c=new K(b,a);return function(a){return c.invoker(a)}}return null}return{get:a.get,annotate:a.annotate,instantiate:a.instantiate,invoke:a.invoke,accepts:h,create:b}}]}];angular.module("dotjem.routing").provider("$inject",J);var K=function(){function a(a,b){this.fn=a,this.$inject=b,u(a)?this.func=a[a.length-1]:r(a)&&(this.func=a)}return a.prototype.invoker=function(a){return this.$inject.invoke(this.fn,this.func,a)},a.FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,a.FN_ARG_SPLIT=/,/,a.FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,a.STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,a}(),L=function(){function a(a,b,c,d){this._name=a,this._fullname=b,this._parent=d,this._children={},this._self=c,this._self.$fullname=b,this._reloadOnOptional=!p(c.reloadOnSearch)||c.reloadOnSearch,this._scrollTo="top",d&&p(d.scrollTo)&&(this._scrollTo=d.scrollTo),p(this._self.scrollTo)&&(this._scrollTo=this._self.scrollTo)}return Object.defineProperty(a.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fullname",{get:function(){return this._fullname},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"reloadOnOptional",{get:function(){return this._reloadOnOptional},set:function(a){this._reloadOnOptional=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"self",{get:function(){return y(this._self)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"route",{get:function(){return this._route},set:function(a){if(q(a))throw Error(D.routeCannotBeUndefined);this._route=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"root",{get:function(){return null===this.parent?this:this._parent.root},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scrollTo",{get:function(){return this._scrollTo},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"views",{get:function(){return this.self.views},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"resolve",{get:function(){return this.self.resolve},enumerable:!0,configurable:!0}),a.prototype.add=function(a){return this._children[a.name]=a,this},a.prototype.resolveRoute=function(){return p(this.route)?this.route.route:p(this.parent)?this.parent.resolveRoute():""},a.prototype.is=function(a){return this.fullname===a||this.fullname===B+"."+a},a.prototype.isActive=function(a){return this.is(a)?!0:this.parent&&this.parent.isActive(a)||!1},a}(),M=function(){function a(a){this.root=a,this.nameRegex=new RegExp("^("+l(B)+"\\.)?\\w+(\\.\\w+)*$"),this.siblingRegex=new RegExp("^\\$node\\(([-+]?\\d+)\\)$"),this.indexRegex=new RegExp("^\\[(-?\\d+)\\]$")}return a.prototype.lookup=function(a,b){for(var c=this.root,d=a.split("."),e=d[0]===B?1:0,b=p(b)?b:0;e<d.length-b;e++){if(!(d[e]in c.children))throw Error("Could not locate '"+d[e]+"' under '"+c.fullname+"'.");c=c.children[d[e]]}return c},a.prototype.resolve=function(a,b,c){var e,f=this,g=this.siblingRegex.exec(b),h=a;if(g?h=this.selectSibling(Number(g[1]),h):this.nameRegex.test(b)?h=this.lookup(b):(e=b.split("/"),w(e,function(b){h=f.select(a,b,h)})),h===this.root)throw Error(D.expressionOutOfBounds);return h?c?y(h.self):h:d},a.prototype.selectSibling=function(a,b){var c=[],d=0;for(w(b.parent.children,function(a){c.push(a),b.fullname===a.fullname&&(d=c.length-1)});0>a;)a+=c.length;return a=(d+a)%c.length,c[a]},a.prototype.select=function(a,b,c){if("."===b){if(a!==c)throw Error(D.invalidBrowserPathExpression);return c}if(".."===b){if(q(c.parent))throw Error(D.expressionOutOfBounds);return c.parent}if(""===b){if(a!==c)throw Error(D.invalidBrowserPathExpression);return this.root}var d=this.indexRegex.exec(b);if(d){var e=Number(d[1]),f=[];if(w(c.children,function(a){f.push(a)}),Math.abs(e)>=f.length)throw Error(D.expressionOutOfBounds);return 0>e?f[f.length+e]:f[e]}if(b in c.children)return c.children[b];throw Error(D.couldNotFindStateForPath+": "+b)},a}(),N=function(){function a(){}return a.prototype.buildStateArray=function(a,b){function c(){var a={};return e.route&&w(e.route.params,function(c,d){a[d]=b[d]}),a}var d=[],e=a;do d.push({state:e,params:c()});while(e=e.parent);return d},a.prototype.compare=function(a,b,c,d,e){for(var f,g,h=this.buildStateArray(a,c||{}),i=this.buildStateArray(b,d),j=Math.max(h.length,i.length),k=!1,l=!z(c,d),m=0;j>m;m++)f=h[h.length-m-1],g=i[i.length-m-1],q(g)?i[0].isChanged=k=!0:g.isChanged=q(f)||e===g.state.fullname||g.state.fullname!==f.state.fullname||!z(g.params,f.params)?k=!0:!1;return i[0].isChanged=k=k||i[0].state.reloadOnOptional&&l,{array:i.reverse(),stateChanges:k,paramChanges:l}},a}(),O=function(){function a(a,b){this.routes=a,this.transitions=b}return a.prototype.createRoute=function(a,b,c,d){var e=b||"";return""!==e&&"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),"/"!==a[0]&&""!==a&&(e+="/"),e+=a,this.routes.when(e,{state:c,reloadOnSearch:d})},a.prototype.createState=function(a,b,c){var d=this,e=a.split(".").pop();p(c)&&(a=c.fullname+"."+e);var f=new L(e,a,b,c);return f.reloadOnOptional=!p(b.reloadOnSearch)||b.reloadOnSearch,p(b.route)&&(f.route=this.createRoute(b.route,c.resolveRoute(),f.fullname,f.reloadOnOptional).$route),p(b.onEnter)&&this.transitions.onEnter(f.fullname,b.onEnter),p(b.onExit)&&this.transitions.onExit(f.fullname,b.onExit),p(b.children)&&w(b.children,function(a,b){f.add(d.createState(f.fullname+"."+b,a,f))}),f},a}(),P=function(){function a(){}return a.validateName=function(b){if(!a.nameValidation.test(b)||b===B)throw new Error("Invalid name: '"+b+"'.")},a.validateTarget=function(b){return"*"===b||a.targetValidation.test(b)?!0:!1},a.nameValidation=/^\w+(\.\w+)*?$/,a.targetValidation=/^\$?\w+(\.\w+)*(\.[*])?$/,a}(),Q=function(){function a(a){this.route=a}return a.prototype.buildUrl=function(a,b,c,d){var e=a;if(!b.route)throw new Error("Can't build url for a state that doesn't have a url defined.");var f={},g=e&&e.$params.$all||{};return w(b.route.params,function(a,b){b in g&&(f[b]=g[b])}),this.route.format(b.route.route,x(f,c||{}),d)},a}(),R={initializeContext:function(a,b,c){return function(d){var e=c.resolve(d.from,a,!1);d.to=e,d.params=b,d.toState=x({},e.self,{$params:b})}},createEmitter:function(a){return function(b){b.emit=a.find(b.$state.current,b.toState)}},buildChanges:function(a){return function(b){b.changed=(new N).compare(b.from,b.to,b.$state.params,b.params,a)}},createTransition:function(a){return function(b){var c={locals:b.locals,canceled:!1,cancel:function(){c.canceled=!0},"goto":function(b,d){c.canceled=!0,a({state:b,params:{$all:d},updateroute:!0})}};b.transition=c}},raiseUpdate:function(a){return function(b){var c=b.changed,d=b.$state;c.stateChanges||(c.paramChanges&&(d.params=b.params,d.current.$params=b.params,a.$broadcast("$stateUpdate",d.current)),b.abort())}},updateRoute:function(a,b){return function(c){var d=c.to.route;if(b&&d){var e={},f=c.$state.params.$all;w(d.params,function(a,b){b in f&&(e[b]=f[b])});var g=x(e,c.params.$all);a.change(x({},d,{params:g})),c.abort()}}},before:function(){return function(a){a.emit.before(a.transition,a.transaction),a.transition.canceled&&a.abort()}},between:function(a){return function(b){b.emit.between(b.transition,b.transaction),b.transition.canceled&&(a.$broadcast("$stateChangeAborted",b.toState,b.$state.current),b.abort())}},after:function(a,b){return function(c){c.transition.canceled||(c.transition.cancel=function(){throw Error("Can't cancel transition in after handler")},c.emit.after(c.transition,c.transaction),a(b))}},beginTransaction:function(a,b){return function(c){c.transaction=a.beginUpdate(),c.transaction.clear();var d=!1;w(c.changed.array,function(a){d=d||a.isChanged,w(a.state.views,function(e,f){var g;p(e.sticky)&&((g=b.create(e.sticky))?e.sticky=g({$to:c.toState,$from:c.$state.current}):s(e.sticky)||(e.sticky=a.state.fullname)),d||e.force||p(e.sticky)?c.prepUpdate(a.state.fullname,f,e):c.prepCreate(a.state.fullname,f,e)})})}}},S=function(){function a(a,b,c){this.aborted=!1,this.completed=!1,this._prep={},this._$state=a,this.to=c,this.onComplete=b}return Object.defineProperty(a.prototype,"$state",{get:function(){return this._$state},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ended",{get:function(){return this.aborted||this.completed},enumerable:!0,configurable:!0}),a.prototype.next=function(b){this.ended||this.abort();var c=new a(this.$state,b);return c.previous=this,c.from=this.to,this.previous=null,c},a.prototype.execute=function(a){return!this.ended&&(a(this),this.aborted)?this.previous:this},a.prototype.complete=function(){return this.ended||(this.onComplete(this),this.completed=!0),this},a.prototype.abort=function(){return this.ended||(this.aborted=!0,this.transaction&&!this.transaction.completed&&this.transaction.cancel()),this},a.prototype.prepUpdate=function(a,b,c){var d=this._prep[a]=this._prep[a]||{};d[b]=this.transaction.prepUpdate(b,c)},a.prototype.prepCreate=function(a,b,c){var d=this._prep[a]=this._prep[a]||{};d[b]=this.transaction.prepCreate(b,c)},a.prototype.completePrep=function(a,b){w(this._prep[a],function(a){a(b)})},a}(),T=["$state","$compile","$controller","$view","$animate","$template",function(a,b,c,e,f,g){return{restrict:"ECA",terminal:!0,priority:1e3,transclude:"element",compile:function(a,h,i){return function(a,h,j){function k(){p(s)&&(s.remove(),s=d,h.contents().show())}function l(){null!==w&&w.then(function(a){h.contents().hide(),h.append(s=angular.element(a))})}function m(a){o&&(o.$destroy(),o=null),q&&(a?f.leave(q):q.remove(),q=null)}function n(d){var g,j=e.get(t);if(j&&j.template){if(j.version===v)return;v=j.version,g=j.controller,j.template.then(function(e){var k=a.$new();i(k,function(a){m(d),a.html(e),d?f.enter(a,null,h):h.after(a);var i,l=b(a.contents());o=k,q=a,g&&(i=x({},j.locals),i.$scope=o,g=c(g,i),a.data("$ngControllerController",g),a.children().data("$ngControllerController",g)),l(o),o.$emit("$viewContentLoaded"),o.$eval(u)})})}else v=-1,m(d)}var o,q,s,t=j.jemView||j.name,u=j.onload||"",v=-1,w=j.loader&&g(j.loader)||null;a.$on(E.VIEW_UPDATE,function(a,b){b===t&&n(!0)}),a.$on(E.VIEW_REFRESH,function(a,b,c){b===t&&(r(o.refresh)?o.refresh(c):o.$broadcast("$refresh",b,c))}),a.$on("$viewPrep",function(a,b,c){b===t&&"update"===c.type?l():"cancel"===c.type&&k()}),n(!1)}}}}];angular.module("dotjem.routing").directive("jemView",T);var U=["$scroll","$timeout",function(a,b){return{restrict:"AC",terminal:!1,link:function(c,d,e){function f(a){a===g&&b(function(){d[0].scrollIntoView()},h)}var g=e.jemAnchor||e.id,h=p(e.delay)?Number(e.delay):1;c.$on("$scrollPositionChanged",function(a,b){f(b)}),f(a.$current)}}}];angular.module("dotjem.routing").directive("jemAnchor",U),angular.module("dotjem.routing").directive("id",U);var V=["$state","$route",function(a,b){return{restrict:"AC",link:function(c,d,e){function f(){var b=c.$eval(e.sref),f=c.$eval(e.params),g=a.url(b,f);j||(g="#"+k+g),d.attr(l[i],g)}function g(){var b=c.$eval(e.sref);a.isActive(b)?d.addClass(e.activeClass):d.removeClass(e.activeClass)}function h(){c.$apply(function(){var b=c.$eval(e.sref),d=c.$eval(e.params);a.goto(b,d)})}var i=d[0].tagName.toLowerCase(),j=b.html5Mode(),k=b.hashPrefix(),l={a:"href",form:"action"},m=A;p(e.activeClass)&&(m=g);var n=c.$on(E.STATE_CHANGE_SUCCESS,m);m(),i in l?(p(e.params)&&c.$watch(e.params,f,!0),e.$observe("sref",f)):d.bind("click",h),c.$on("$destroy",function(){d.unbind("click",h),n()})}}}];angular.module("dotjem.routing").directive("sref",V),c.State=L,c.StateBrowser=M,c.StateComparer=N,c.StateFactory=O,c.StateRules=P,c.StateUrlBuilder=Q,c.RootName=B}(window,document,dotjem||(dotjem={}));