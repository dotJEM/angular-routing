/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
(function(t,e,n){"use strict";function r(t,e){return w(new(w(function(){},{prototype:t})),e)}function a(t){return m(t)?t:t.$fullname||t.fullname}function o(t){if(v(t))for(var e=0;t.length>e;e++){if(t.length-1>e&&!m(t[e]))return null;if(e===t.length-1&&d(t[e]))return t[e]}return null}function i(t){var e=[];return $(t,function(t,n){e.push(u(n,!0)+(t===!0?"":"="+u(t,!0)))}),e.length?e.join("&"):""}function u(t,e){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,e?"%20":"+")}function c(){function t(t){var e=null;return function(n,r){return null===e&&(e=t?m(t)?function(e,n){var r=a(t,n.params);e.path(r).search(n.params).replace()}:function(e,n){e.url(t(n.pathParams,e.path(),e.search())).replace()}:function(){}),e(n,r)}}function e(t,e,n){var r;if(n&&(r=n.trim(),"{"===r[0]&&"}"===r[r.length-1]||"["===r[0]&&"]"===r[r.length-1]))try{n=angular.fromJson(r)}catch(a){}return{name:t,converter:function(){return p[e](n)}}}function a(t,e){var n="",r=0;return $(u(t),function(a){""!==a.converter,n+=t.slice(r,a.index)+"/"+(""+e[a.name]),r=a.lastIndex,delete e[a.name]}),n+=t.substr(r)}function o(t){return t.replace(y,"\\$&")}function u(t){var e,n=[];if(null===t)return n;for(;null!==(e=S.exec(t));)n.push({name:e[3]||e[9],converter:e[6]||"",args:e[8],index:e.index,lastIndex:S.lastIndex});return n}function c(t){var n="^",r="",a=[],i=0,c="",l={};return null===t?{name:null,params:l}:"/"===t?{exp:RegExp("^[/]?$",c),segments:[],name:r,params:l}:($(u(t),function(u,c){var s="";n+=o(t.slice(i,u.index)),n+="/([^\\/]*)",""!==u.converter&&(s=":"+u.converter),r+=t.slice(i,u.index)+"/$"+c+s,l[u.name]={id:c,converter:u.converter},a.push(e(u.name,u.converter,u.args)),i=u.lastIndex}),n+=o(t.substr(i)),r+=t.substr(i),v||(r=r.toLowerCase(),c+="i"),"/"===n[n.length-1]&&(n=n.substr(0,n.length-1)),{exp:RegExp(n+"/?$",c),segments:a,name:r,params:l})}function l(t,e){return null==t?function(){}:function(t){var r,a=t.match(e.exp),o={};return a&&(r=!1,$(e.segments,function(t,e){var n,i;r||(n=a[e+1],i=t.converter()(n),h(i.accept)?(i.accept||(r=!0),o[t.name]=i.value):(i||(r=!0),o[t.name]=n))}),!r)?o:n}}var s=this,f={},p={},d={},v=!0;this.convert=function(t,e){return p[t]=e,s},this.when=function(e,n){var r=c(e);return f[r.name]={self:w({reloadOnSearch:!0},n),redirect:t(n.redirectTo),match:l(e,r),params:r.params,path:e},{convert:s.convert,when:s.when,otherwise:s.otherwise,decorate:s.decorate,ignoreCase:s.ignoreCase,matchCase:s.matchCase,$route:{name:r.name,params:b(r.params),route:e}}},this.otherwise=function(t){return s.when(null,t),s},this.decorate=function(t,e){return d[t]=e,s},this.ignoreCase=function(){return v=!1,s},this.matchCase=function(){return v=!0,s};var y=/[-\/\\^$*+?.()|[\]{}]/g,S=RegExp("/((:(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\w+)\\}))","g");this.convert("num",function(){return function(t){var e=!isNaN(t);return{accept:e,value:e?Number(t):0}}}),this.convert("regex",function(t){var e,n,r="";if(g(t)&&h(t.exp))e=t.exp,h(t.flags)&&(r=t.flags);else{if(!(m(t)&&t.length>0))throw Error("The Regular-expression converter was not initialized with a valid object.");e=t}return n=RegExp(e,r),function(t){var e=n.test(t);return{accept:e,value:e?n.exec(t):null}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams",function(t,e,o,u,c){function l(t,e,n){var a=r(t,{self:r(t.self,{params:w({},n,e),searchParams:n,pathParams:e})});return a}function s(t){var n,r;return $(f,function(a){!r&&(n=a.match(t))&&(r=l(a,n,e.search()))}),r||f[null]&&l(f[null],{},{})}function h(){var r=s(e.path()),a=m.current,i=r?r.self:n;if(!p&&i&&a&&angular.equals(i.pathParams,a.pathParams)&&!i.reloadOnSearch)a.params=r.params,a.searchParams=r.searchParams,a.pathParams=r.pathParams,b(i.params,c),t.$broadcast("$routeUpdate",a);else if(r||a){p=!1;var l=t.$broadcast("$routeChangeStart",i,a);if(!l.defaultPrevented){m.current=i,r&&r.redirect(e,i);var f=o.when(i);i&&$(d,function(t){f=f.then(function(){var e=u.invoke(t,i,{$next:i});return o.when(e)})}),f.then(function(){i===m.current&&(r&&angular.copy(i.params,c),t.$broadcast("$routeChangeSuccess",i,a))},function(e){i===m.current&&t.$broadcast("$routeChangeError",i,a,e)})}}}var p=!1,m={routes:f,reload:function(){p=!0,t.$evalAsync(h)},change:function(t){var n=t.params||{},r=a(t.route,n),o=e.path(r).search(n||{});t.replace&&o.replace()},format:function(t,e){var e=e||{};return a(t,e)+i(e)}};return t.$on("$locationChangeSuccess",h),m}]}function l(){function t(t){var e={handler:{}};return h(t.to)&&(e.to=t.to),h(t.from)&&(e.from=t.from),h(t.handler)&&(e.handler=t.handler),h(t.before)&&p(e.handler.before)&&(e.handler.before=t.before),h(t.between)&&p(e.handler.between)&&(e.handler.between=t.between),h(t.after)&&p(e.handler.after)&&(e.handler.after=t.after),e}function e(t,e){var r=n(t),a=n(e);if(!r||!a){if(r)throw Error("Invalid transition - to: '"+e+"'.");if(a)throw Error("Invalid transition - from: '"+t+"'.");throw Error("Invalid transition - from: '"+t+"', to: '"+e+"'.")}}function n(t){return"*"===t||i.test(t)?!0:!1}function r(t){for(var e=o,n=t.split("."),r="root"===n[0]?1:0;n.length>r;r++)n[r]in e.children||(e.children[n[r]]={children:{},targets:{}}),e=e.children[n[r]];return e}var o={children:{},targets:{}},i=/^\w+(\.\w+)*(\.[*])?$/,u=this;this.onEnter=function(e,n){if(g(n)){var r=t(n);this.transition(r.from||"*",e,r.handler)}else(d(n)||v(n))&&this.transition("*",e,n)},this.onExit=function(e,n){if(g(n)){var r=t(n);this.transition(e,r.to||"*",r.handler)}else(d(n)||v(n))&&this.transition(e,"*",n)},this.transition=function(t,n,o){var i,u=this;if(v(t))$(t,function(t){u.transition(t,n,o)});else if(v(n))$(n,function(e){u.transition(t,e,o)});else{if(t=a(t),n=a(n),n===t&&-1===n.indexOf("*"))return this;e(t,n),(angular.isFunction(o)||angular.isArray(o))&&(o={between:o}),i=r(t),n in i.targets||(i.targets[n]=[]),o.name=t+" -> "+n,i.targets[n].push(o)}return this},this.$get=["$q","$injector",function(t,e){function n(t,n){function r(r,a){var o;$(i,function(i){h(o=r(i))&&e.invoke(o,u,{$to:n,$from:t,$transition:a})})}var o=l(a(t)),i=c(o,a(n));return{before:function(t){r(function(t){return t.before},t)},between:function(t){r(function(t){return t.between},t)},after:function(t){r(function(t){return t.after},t)}}}function r(t){return"root"===t[0]&&t.splice(0,1),t}function i(t,e){for(var n,a,o=r(t.split(".")).reverse(),i=r(e.split(".")).reverse();;){if(n=o.pop(),a=i.pop(),"*"===a||"*"===n)return!0;if(n!==a)return!1;if(!h(n)||!h(a))return!0}return!0}function c(t,e){var n=[];return $(t,function(t){$(t.targets,function(t,r){i(r,e)&&$(t,function(t){n.push(t)})})}),n}function l(t){var e=o,n=t.split("."),r=[],a="root"===n[0]?1:0;do{if("*"in e.children&&r.push(e.children["*"]),!(n[a]in e.children))break;e=e.children[n[a]],r.push(e)}while(a++<n.length);return r}var s={root:o,find:n};return s}]}function s(){var t=RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))","i");this.$get=["$http","$q","$injector","$templateCache",function(e,n,r,a){function o(t){return e.get(t,{cache:a}).then(function(t){return t.data})}function i(t){return n.when(r.invoke(t))}function u(t){if(h(t.url))return o(t.url);if(h(t.fn))return i(t.fn);if(h(t.html))return n.when(t.html);throw Error("Object must define url, fn or html.")}return this.get=function(e){if(m(e))return t.test(e)?o(e):n.when(e);if(d(e)||v(e))return i(e);if(g(e))return u(e);throw Error("Template must be either an url as string, function or a object defining either url, fn or html.")},this}]}function f(){this.$get=["$rootScope","$q","$template",function(t,e,r){function a(t){if("undefined"===t)throw Error("Must define a view name.")}function o(e){t.$broadcast("$viewUpdate",e)}function i(e,n){t.$broadcast("$viewRefresh",e,n)}function u(t,e){return e in t&&null!==t[e]}function c(t){return g(t)&&(h(t.template)||h(t.controller)||h(t.locals)||h(t.sticky))}var l={},s=null;return this.clear=function(t){var e=this;if(p(t))$(l,function(t,n){e.clear(n)});else{if(s)return s.records[t]={act:"clear",fn:function(){e.clear(t)}},n;delete l[t],o(t)}},this.setOrUpdate=function(t,e,f,p,d){var g=this,v=e;return c(e)&&(v=e.template,f=e.controller,p=e.locals,d=e.sticky),a(t),s?(s.records[t]={act:"setOrUpdate",fn:function(){g.setOrUpdate(t,v,f,p,d)}},n):(u(l,t)||(l[t]={version:-1}),l[t].template=r.get(v),l[t].controller=f,l[t].locals=p,h(d)&&m(d)&&l[t].sticky===d?i(t,{sticky:!0}):(l[t].version++,l[t].sticky=d,o(t)),n)},this.setIfAbsent=function(t,e,i,f){var h=this,p=e;return c(e)&&(p=e.template,i=e.controller,f=e.locals),a(t),s?(u(s.records,t)&&"clear"!==s.records[t].act||(s.records[t]={act:"setIfAbsent",fn:function(){h.setIfAbsent(t,p,i,f)}}),n):(u(l,t)||(l[t]={template:r.get(p),controller:i,locals:f,version:0},o(t)),n)},this.get=function(t){return p(t)?l:l[t]},this.refresh=function(t,e){var r=this;if(p(t))$(l,function(t,e){r.clear(e)});else{if(s)return s.records[t]={act:"refresh",fn:function(){r.refresh(t,e)}},n;i(t,e)}},this.beginUpdate=function(){if(s)throw Error("Can't start multiple transactions");var t=s={records:{}};return{commit:function(){s=null,$(t.records,function(t){t.fn()})},cancel:function(){s=null}}},this}]}var h=angular.isDefined,p=angular.isUndefined,d=angular.isFunction,m=angular.isString,g=angular.isObject,v=angular.isArray,$=angular.forEach,w=angular.extend,b=angular.copy,y=angular.equals;angular.element,angular.module("ui.routing",[]),angular.module("ui.routing").provider("$route",c).value("$routeParams",{}),angular.module("ui.routing").provider("$stateTransition",l);var S=["$routeProvider","$stateTransitionProvider",function(t,e){var r=new x.routing.StateFactory(t,e),o=r.createState("root",{}),i=new x.routing.StateBrowser(o),u=new x.routing.StateComparer;this.state=function(t,e){x.routing.StateRules.validateName(t);var n=i.lookup(t,1);return n.add(r.createState(t,e,n)),this},this.$get=["$rootScope","$q","$injector","$route","$view","$stateTransition","$location","$scroll",function(t,e,r,c,l,s,f,p){function y(t,e){var n=k.current;if(t=h(t)?i.lookup(a(t)):O,!t.route)throw Error("Can't build url for a state that doesn't have a url defined.");var r={},o=n&&n.$params&&n.$params.all||{};return $(t.route.params,function(t,e){e in o&&(r[e]=o[e])}),c.format(t.route.route,w(r,e||{}))}function S(e){h(e)?m(e)||g(e)?(E=a(e),0!==E.indexOf("root")&&(E="root."+E)):e&&(E=o.fullname):E=O.fullname,t.$evalAsync(function(){C({state:O,params:P,route:c.current})})}function x(e,n,r){var a=k.current.$params;a.all=e,a.path=n,a.search=r,t.$broadcast("$stateUpdate",k.current)}function C(o){var f,g,y=o.params,S=o.route,j=i.lookup(a(o.state)),_=w({},j.self,{$params:y,$route:S}),I=k.current,R=s.find(k.current,_),A=!1,U=u.compare(i.lookup(a(k.current)),j,I.$params&&I.$params.all,y&&y.all||{},E),q={cancel:function(){A=!0},"goto":function(t,e){A=!0,C({state:t,params:{all:e},updateroute:!0})}};if(!E&&!U.stateChanges)return U.paramChanges&&x(y.all||{},y.path||{},y.search||{}),n;if(E=null,o.updateroute&&j.route){var N={},T=I.$params&&I.$params.all||{};$(j.route.params,function(t,e){e in T&&(N[e]=T[e])});var V=w(N,y&&y.all);return c.change(w({},j.route,{params:V})),n}if(R.before(q),!A){var F=t.$broadcast("$stateChangeStart",_,I);F.defaultPrevented||e.when(_).then(function(){function a(t){var n=[],a=[];angular.forEach(t||{},function(t,e){a.push(e),n.push(angular.isString(t)?r.get(t):r.invoke(t))});var o=e.defer();return e.all(n).then(function(t){angular.forEach(t,function(t,e){i[a[e]]=t}),o.resolve(i)}),o.promise}var o=!1,i={};f=l.beginUpdate(),l.clear();var u=e.when(0);return $(U.array,function(t){u=u.then(function(){return a(t.state.self.resolve)}).then(function(e){t.isChanged&&(o=!0),g=t.state.self.scrollTo,$(t.state.self.views,function(n,a){var i;n.sticky&&(i=n.sticky,d(i)||v(i)?i=r.invoke(i,i,{$to:_,$from:I}):m(i)||(i=t.state.fullname)),o||h(i)?l.setOrUpdate(a,n.template,n.controller,b(e),i):l.setIfAbsent(a,n.template,n.controller,b(e))})})}),u.then(function(){return R.between(q),A?(f.cancel(),n):(O=j,P=y,k.current=_,f.commit(),t.$broadcast("$stateChangeSuccess",_,I),n)})},function(e){f.cancel(),t.$broadcast("$stateChangeError",_,I,e)}).then(function(){A||(q.cancel=function(){throw Error("Can't cancel transition in after handler")},R.after(q),p(g))})}}var E=null,O=o,P={},k={root:o,current:w({},o.self),"goto":function(t,e){C({state:t,params:{all:e},updateroute:!0})},lookup:function(t){return i.resolve(O,t)},reload:S,url:y};return t.$on("$routeChangeSuccess",function(){var t,e=c.current;e?(t={all:e.params,path:e.pathParams,search:e.searchParams},e.state&&C({state:e.state,params:t,route:e})):C({state:o})}),t.$on("$routeUpdate",function(){var t=c.current;x(t.params,t.pathParams,t.searchParams)}),k}]}];angular.module("ui.routing").provider("$state",S);var x;(function(t){(function(t){var e=function(){function t(t,e,n,r){this._name=t,this._fullname=e,this._parent=r,this._children={},this._self=n,this._self.$fullname=e,this._reloadOnOptional=!h(n.reloadOnSearch)||n.reloadOnSearch}return Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullname",{get:function(){return this._fullname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloadOnOptional",{get:function(){return this._reloadOnOptional},set:function(t){this._reloadOnOptional=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"self",{get:function(){return b(this._self)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"route",{get:function(){return this._route},set:function(t){if(p(t))throw"Please supply time interval";this._route=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return null===this.parent?this:this._parent.root},enumerable:!0,configurable:!0}),t.prototype.add=function(t){return this._children[t.name]=t,this},t.prototype.resolveRoute=function(){return h(this.route)?this.route.route:h(this.parent)?this.parent.resolveRoute():""},t}();t.State=e})(t.routing||(t.routing={})),t.routing})(x||(x={}));var x;(function(t){(function(t){var e=function(){function t(t){this.root=t}return t.prototype.lookup=function(t,e){for(var n=this.root,r=t.split("."),a="root"===r[0]?1:0,e=h(e)?e:0;r.length-e>a;a++){if(!(r[a]in n.children))throw Error("Could not locate '"+r[a]+"' under '"+n.fullname+"'.");n=n.children[r[a]]}return n},t.prototype.resolve=function(t,e){var r,a=this,o=e.match("^\\$node\\(([-+]?\\d+)\\)$"),i=t;if(o?i=this.selectSibling(Number(o[1]),i):(r=e.split("/"),$(r,function(e){i=a.select(t,e,i)})),i===this.root)throw Error("Path expression out of bounds.");return i&&w({},i.self)||n},t.prototype.selectSibling=function(t,e){var n,r=[];for($(e.parent.children,function(t){r.push(t),e.fullname===t.fullname&&(n=r.length-1)});0>t;)t+=r.length;return t=(n+t)%r.length,r[t]},t.prototype.select=function(t,e,n){if("."===e){if(t!==n)throw Error("Invalid path expression. Can only define '.' i the beginning of an expression.");return n}if(".."===e){if(p(n.parent))throw Error("Path expression out of bounds.");return n.parent}if(""===e){if(t!==n)throw Error("Invalid path expression.");return this.root}var r=e.match("^\\[(-?\\d+)\\]$");if(r){var a=Number(r[1]),o=[];if($(n.children,function(t){o.push(t)}),Math.abs(a)>=o.length)throw Error("Index out of bounds, index selecter must not exeed child count or negative childcount");return 0>a?o[o.length+a]:o[a]}if(e in n.children)return n.children[e];throw Error("Could find state for the lookup path.")},t}();t.StateBrowser=e})(t.routing||(t.routing={})),t.routing})(x||(x={}));var x;(function(t){(function(t){var e=function(){function t(){}return t.prototype.buildStateArray=function(t,e){function n(){var t={};return a.route&&$(a.route.params,function(n,r){t[r]=e[r]}),t}var r=[],a=t;do r.push({state:a,params:n()});while(a=a.parent);return r},t.prototype.compare=function(t,e,n,r,a){for(var o,i,u=this.buildStateArray(t,n||{}),c=this.buildStateArray(e,r),l=Math.max(u.length,c.length),s=!1,f=!y(n,r),h=0;l>h;h++)o=u[u.length-h-1],i=c[c.length-h-1],p(i)?c[0].isChanged=s=!0:i.isChanged=p(o)||a&&a==i.state.fullname||i.state.fullname!==o.state.fullname||!y(i.params,o.params)?s=!0:!1;return s=s||c[0].state.reloadOnOptional&&f,{array:c.reverse(),stateChanges:s,paramChanges:f}},t}();t.StateComparer=e})(t.routing||(t.routing={})),t.routing})(x||(x={}));var x;(function(t){(function(t){var e=function(){function e(t,e){this.routes=t,this.transitions=e}return e.prototype.createRoute=function(t,e,n,r){var a=e||"";return""!==a&&"/"===a[a.length-1]&&(a=a.substr(0,a.length-1)),"/"!==t[0]&&""!==t&&(a+="/"),a+=t,this.routes.when(a,{state:n,reloadOnSearch:r})},e.prototype.createState=function(e,n,r){var a=this,o=e.split(".").pop();h(r)&&(e=r.fullname+"."+o);var i=new t.State(o,e,n,r);return i.reloadOnOptional=!h(n.reloadOnSearch)||n.reloadOnSearch,h(n.route)&&(i.route=this.createRoute(n.route,r.resolveRoute(),i.fullname,i.reloadOnOptional).$route),h(n.onEnter)&&this.transitions.onEnter(i.fullname,n.onEnter),h(n.onExit)&&this.transitions.onExit(i.fullname,n.onExit),h(n.children)&&$(n.children,function(t,e){i.add(a.createState(i.fullname+"."+e,t,i))}),i},e}();t.StateFactory=e})(t.routing||(t.routing={})),t.routing})(x||(x={}));var x;(function(t){(function(t){var e=function(){function t(){}return t.nameValidation=/^\w+(\.\w+)*?$/,t.validateName=function(e){if(!t.nameValidation.test(e))throw Error("Invalid name: '"+e+"'.")},t}();t.StateRules=e})(t.routing||(t.routing={})),t.routing})(x||(x={})),angular.module("ui.routing").provider("$template",s),angular.module("ui.routing").provider("$view",f);var C=["$anchorScrollProvider",function(){this.$get=["$window","$rootScope","$location","$anchorScroll","$injector","$timeout",function(t,e,n,r,a,i){function u(t){t&&t.scrollIntoView()}function c(e){var n;p(e)?r():m(e)?"top"===e?t.scroll(0,0):u(angular.element(e)[0]):null!==(n=o(e))&&u(angular.element(a.invoke(e,n))[0])}return t.document,function(t){i(function(){c(t)},0)}}]}];angular.module("ui.routing").provider("$scroll",C);var E=["$state","$scroll","$compile","$controller","$view","$animator",function(t,e,n,r,a,o){return{restrict:"ECA",terminal:!0,link:function(t,e,i){function u(){s&&(s.$destroy(),s=null)}function c(t){t?g.leave(e.contents(),e):e.html(""),u()}function l(o){var i,u=a.get(f);if(u&&u.template){if(u.version===v)return;v=u.version,i=u.controller,u.template.then(function(a){c(o),o?g.enter(angular.element("<div></div>").html(a).contents(),e):e.html(a);var l,f=n(e.contents());s=t.$new(),i&&(l=b(u.locals),l.$scope=s,l.$async=function(){return function(){}},i=r(i,l),e.contents().data("$ngControllerController",i)),f(s),s.$emit("$viewContentLoaded"),s.$eval(m)})}else c(o)}var s,f=i.uiView||i.name,p=h(i.ngAnimate),m=i.onload||"",g=o(t,i),v=-1;t.$on("$viewChanged",function(t,e){e===f&&l(p)}),t.$on("$viewRefresh",function(t,e,n){e===f&&(d(s.refresh)?s.refresh(n):s.$broadcast("$refresh",e,n))}),t.$on("$stateChangeSuccess",function(){return l(p)}),l(!1)}}}];angular.module("ui.routing").directive("uiView",E)})(window,document);