/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
(function(n,r,t){"use strict";function e(n,r){return w(new(w(function(){},{prototype:n})),r)}function a(n){return m(n)?n:n.$fullname||n.fullname}function o(n){if(g(n))for(var r=0;n.length>r;r++){if(n.length-1>r&&!m(n[r]))return null;if(r===n.length-1&&p(n[r]))return n[r]}return null}function i(n){var r=[];return $(n,function(n,t){r.push(u(t,!0)+(n===!0?"":"="+u(n,!0)))}),r.length?r.join("&"):""}function u(n,r){return encodeURIComponent(n).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,r?"%20":"+")}function c(){function n(n){var r=null;return function(t,e){return null===r&&(r=n?m(n)?function(r,t){var e=a(n,t.params);r.path(e).search(t.params).replace()}:function(r,t){r.url(n(t.pathParams,r.path(),r.search())).replace()}:function(){}),r(t,e)}}function r(n,r,t){var e;if(t&&(e=t.trim(),"{"===e[0]&&"}"===e[e.length-1]||"["===e[0]&&"]"===e[e.length-1]))try{t=angular.fromJson(e)}catch(a){}return{name:n,converter:function(){return d[r](t)}}}function a(n,r){var t="",e=0;return $(u(n),function(a){""!==a.converter,t+=n.slice(e,a.index)+"/"+(""+r[a.name]),e=a.lastIndex,delete r[a.name]}),t+=n.substr(e)}function o(n){return n.replace(x,"\\$&")}function u(n){var r,t=[];if(null===n)return t;for(;null!==(r=C.exec(n));)t.push({name:r[3]||r[9],converter:r[6]||"",args:r[8],index:r.index,lastIndex:C.lastIndex});return t}function c(n){var t="^",e="",a=[],i=0,c="",l={};return null===n?{name:null,params:l}:"/"===n?{exp:RegExp("^[/]?$",c),segments:[],name:e,params:l}:($(u(n),function(u,c){var s="";t+=o(n.slice(i,u.index)),t+="/([^\\/]*)",""!==u.converter&&(s=":"+u.converter),e+=n.slice(i,u.index)+"/$"+c+s,l[u.name]={id:c,converter:u.converter},a.push(r(u.name,u.converter,u.args)),i=u.lastIndex}),t+=o(n.substr(i)),e+=n.substr(i),g||(e=e.toLowerCase(),c+="i"),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),{exp:RegExp(t+"/?$",c),segments:a,name:e,params:l})}function l(n,r){return null==n?function(){}:function(n){var e,a=n.match(r.exp),o={};return a&&(e=!1,$(r.segments,function(n,r){var t,i;e||(t=a[r+1],i=n.converter()(t),h(i.accept)?(i.accept||(e=!0),o[n.name]=i.value):(i||(e=!0),o[n.name]=t))}),!e)?o:t}}var s=this,f={},d={},p={},g=!0;this.convert=function(n,r){return d[n]=r,s},this.when=function(r,t){var e=c(r);return f[e.name]={self:w({reloadOnSearch:!0},t),redirect:n(t.redirectTo),match:l(r,e),params:e.params,path:r},{convert:s.convert,when:s.when,otherwise:s.otherwise,decorate:s.decorate,ignoreCase:s.ignoreCase,matchCase:s.matchCase,$route:{name:e.name,params:b(e.params),route:r}}},this.otherwise=function(n){return s.when(null,n),s},this.decorate=function(n,r){return p[n]=r,s},this.ignoreCase=function(){return g=!1,s},this.matchCase=function(){return g=!0,s};var x=/[-\/\\^$*+?.()|[\]{}]/g,C=RegExp("/((:(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\w+)\\}))","g");this.convert("num",function(){return function(n){var r=!isNaN(n);return{accept:r,value:r?Number(n):0}}}),this.convert("regex",function(n){var r,t,e="";if(v(n)&&h(n.exp))r=n.exp,h(n.flags)&&(e=n.flags);else{if(!(m(n)&&n.length>0))throw Error("The Regular-expression converter was not initialized with a valid object.");r=n}return t=RegExp(r,e),function(n){var r=t.test(n);return{accept:r,value:r?t.exec(n):null}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams",function(n,r,o,u,c){function l(n,r,t){var a=e(n,{self:e(n.self,{params:w({},t,r),searchParams:t,pathParams:r})});return a}function s(n){var t,e;return $(f,function(a){!e&&(t=a.match(n))&&(e=l(a,t,r.search()))}),e||f[null]&&l(f[null],{},{})}function h(){var e=s(r.path()),a=m.current,i=e?e.self:t;if(!d&&i&&a&&angular.equals(i.pathParams,a.pathParams)&&!i.reloadOnSearch)a.params=e.params,a.searchParams=e.searchParams,a.pathParams=e.pathParams,b(i.params,c),n.$broadcast("$routeUpdate",a);else if(e||a){d=!1;var l=n.$broadcast("$routeChangeStart",i,a);if(!l.defaultPrevented){m.current=i,e&&e.redirect(r,i);var f=o.when(i);i&&$(p,function(n){f=f.then(function(){var r=u.invoke(n,i,{$next:i});return o.when(r)})}),f.then(function(){i===m.current&&(e&&angular.copy(i.params,c),n.$broadcast("$routeChangeSuccess",i,a))},function(r){i===m.current&&n.$broadcast("$routeChangeError",i,a,r)})}}}var d=!1,m={routes:f,reload:function(){d=!0,n.$evalAsync(h)},change:function(n){var t=n.params||{},e=a(n.route,t),o=r.path(e).search(t||{});n.replace&&o.replace()},format:function(n,r){var r=r||{};return a(n,r)+i(r)}};return n.$on("$locationChangeSuccess",h),m}]}function l(){function n(n){var r={handler:{}};return h(n.to)&&(r.to=n.to),h(n.from)&&(r.from=n.from),h(n.handler)&&(r.handler=n.handler),h(n.before)&&d(r.handler.before)&&(r.handler.before=n.before),h(n.between)&&d(r.handler.between)&&(r.handler.between=n.between),h(n.after)&&d(r.handler.after)&&(r.handler.after=n.after),r}function r(n,r){var e=t(n),a=t(r);if(!e||!a){if(e)throw Error("Invalid transition - to: '"+r+"'.");if(a)throw Error("Invalid transition - from: '"+n+"'.");throw Error("Invalid transition - from: '"+n+"', to: '"+r+"'.")}}function t(n){return"*"===n||i.test(n)?!0:!1}function e(n){for(var r=o,t=n.split("."),e="root"===t[0]?1:0;t.length>e;e++)t[e]in r.children||(r.children[t[e]]={children:{},targets:{}}),r=r.children[t[e]];return r}var o={children:{},targets:{}},i=/^\w+(\.\w+)*(\.[*])?$/,u=this;this.onEnter=function(r,t){if(v(t)){var e=n(t);this.transition(e.from||"*",r,e.handler)}else(p(t)||g(t))&&this.transition("*",r,t)},this.onExit=function(r,t){if(v(t)){var e=n(t);this.transition(r,e.to||"*",e.handler)}else(p(t)||g(t))&&this.transition(r,"*",t)},this.transition=function(n,t,o){var i,u=this;if(g(n))$(n,function(n){u.transition(n,t,o)});else if(g(t))$(t,function(r){u.transition(n,r,o)});else{if(n=a(n),t=a(t),t===n&&-1===t.indexOf("*"))return this;r(n,t),(angular.isFunction(o)||angular.isArray(o))&&(o={between:o}),i=e(n),t in i.targets||(i.targets[t]=[]),o.name=n+" -> "+t,i.targets[t].push(o)}return this},this.$get=["$q","$injector",function(n,r){function t(n,t){function e(e,a){var o;$(i,function(i){h(o=e(i))&&r.invoke(o,u,{$to:t,$from:n,$transition:a})})}var o=l(a(n)),i=c(o,a(t));return{before:function(n){e(function(n){return n.before},n)},between:function(n){e(function(n){return n.between},n)},after:function(n){e(function(n){return n.after},n)}}}function e(n){return"root"===n[0]&&n.splice(0,1),n}function i(n,r){for(var t,a,o=e(n.split(".")).reverse(),i=e(r.split(".")).reverse();;){if(t=o.pop(),a=i.pop(),"*"===a||"*"===t)return!0;if(t!==a)return!1;if(!h(t)||!h(a))return!0}return!0}function c(n,r){var t=[];return $(n,function(n){$(n.targets,function(n,e){i(e,r)&&$(n,function(n){t.push(n)})})}),t}function l(n){var r=o,t=n.split("."),e=[],a="root"===t[0]?1:0;do{if("*"in r.children&&e.push(r.children["*"]),!(t[a]in r.children))break;r=r.children[t[a]],e.push(r)}while(a++<t.length);return e}var s={root:o,find:t};return s}]}function s(){var n=RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))","i");this.$get=["$http","$q","$injector","$templateCache",function(r,t,e,a){function o(n){return r.get(n,{cache:a}).then(function(n){return n.data})}function i(n){return t.when(e.invoke(n))}function u(n){if(h(n.url))return o(n.url);if(h(n.fn))return i(n.fn);if(h(n.html))return t.when(n.html);throw Error("Object must define url, fn or html.")}return this.get=function(r){if(m(r))return n.test(r)?o(r):t.when(r);if(p(r)||g(r))return i(r);if(v(r))return u(r);throw Error("Template must be either an url as string, function or a object defining either url, fn or html.")},this}]}function f(){this.$get=["$rootScope","$q","$template",function(n,r,e){function a(n){if("undefined"===n)throw Error("Must define a view name.")}function o(r){n.$broadcast("$viewUpdate",r)}function i(r,t){n.$broadcast("$viewRefresh",r,t)}function u(n,r){return r in n&&null!==n[r]}function c(n){return v(n)&&(h(n.template)||h(n.controller)||h(n.locals)||h(n.sticky))}var l={},s=null;return this.clear=function(n){var r=this;if(d(n))$(l,function(n,t){r.clear(t)});else{if(s)return s.records[n]={act:"clear",fn:function(){r.clear(n)}},t;delete l[n],o(n)}},this.setOrUpdate=function(n,r,f,d,p){var v=this,g=r;return c(r)&&(g=r.template,f=r.controller,d=r.locals,p=r.sticky),a(n),s?(s.records[n]={act:"setOrUpdate",fn:function(){v.setOrUpdate(n,g,f,d,p)}},t):(u(l,n)||(l[n]={version:-1}),l[n].template=e.get(g),l[n].controller=f,l[n].locals=d,h(p)&&m(p)&&l[n].sticky===p?i(n,{sticky:!0}):(l[n].version++,l[n].sticky=p,o(n)),t)},this.setIfAbsent=function(n,r,i,f){var h=this,d=r;return c(r)&&(d=r.template,i=r.controller,f=r.locals),a(n),s?(u(s.records,n)&&"clear"!==s.records[n].act||(s.records[n]={act:"setIfAbsent",fn:function(){h.setIfAbsent(n,d,i,f)}}),t):(u(l,n)||(l[n]={template:e.get(d),controller:i,locals:f,version:0},o(n)),t)},this.get=function(n){return d(n)?l:l[n]},this.refresh=function(n,r){var e=this;if(d(n))$(l,function(n,r){e.clear(r)});else{if(s)return s.records[n]={act:"refresh",fn:function(){e.refresh(n,r)}},t;i(n,r)}},this.beginUpdate=function(){if(s)throw Error("Can't start multiple transactions");var n=s={records:{}};return{commit:function(){s=null,$(n.records,function(n){n.fn()})},cancel:function(){s=null}}},this}]}var h=angular.isDefined,d=angular.isUndefined,p=angular.isFunction,m=angular.isString,v=angular.isObject,g=angular.isArray,$=angular.forEach,w=angular.extend,b=angular.copy,x=angular.equals;angular.element,angular.module("ui.routing",[]),angular.module("ui.routing").provider("$route",c).value("$routeParams",{}),angular.module("ui.routing").provider("$stateTransition",l);var C=["$routeProvider","$stateTransitionProvider",function(n,r){function e(n){if(!C.test(n))throw Error("Invalid name: '"+n+"'.")}function o(r,t,e,a){var o;return o=t||"",""!==o&&"/"===o[o.length-1]&&(o=o.substr(0,o.length-1)),"/"!==r[0]&&""!==r&&(o+="/"),o+=r,n.when(o,{state:e,reloadOnSearch:a})}function i(n){for(;h(n)&&!h(n.route);)n=n.parent;return n&&n.route.route||""}function u(n,t,e){var a=t.fullname+"."+n,c=t;h(t.children)||(t.children={}),n in t.children||(t.children[n]={}),t=t.children[n],t.self=w({},e,{$fullname:a}),t.fullname=a,t.parent=c,t.reloadOnOptional=!h(e.reloadOnSearch)||e.reloadOnSearch,h(e.route)&&(t.route=o(e.route,i(c),a,t.reloadOnOptional).$route),h(e.onEnter)&&r.onEnter(a,e.onEnter),h(e.onExit)&&r.onExit(a,e.onExit),null===e.children?t.children={}:$(e.children,function(n,r){u(r,t,n)})}function c(n){for(var r=f,t="root"===n[0]?1:0;n.length>t;t++){if(!(n[t]in r.children))throw Error("Could not locate '"+n[t]+"' under '"+r.fullname+"'.");r=r.children[n[t]]}return r}function l(n){return c(n.split("."))}function s(n){var r=n.split("."),n=r.pop();return{at:c(r),name:n}}var f={fullname:"root",children:{},self:{$fullname:"root"},reloadOnOptional:!0},C=/^\w+(\.\w+)*?$/;this.state=function(n,r){var t;return e(n),t=s(n),u(t.name,t.at,r),this},this.$get=["$rootScope","$q","$injector","$route","$view","$stateTransition","$location","$scroll",function(n,r,e,o,i,u,c,s){function C(n){var r,e=n.match("^\\$node\\(([-+]?\\d+)\\)$"),a=j;if(e?a=E(Number(e[1]),a):(r=n.split("/"),$(r,function(n){a=P(n,a)})),a===f)throw Error("Path expression out of bounds.");return a&&w({},a.self)||t}function E(n,r){var t,e=[];for($(r.parent.children,function(n){e.push(n),r.fullname===n.fullname&&(t=e.length-1)});0>n;)n+=e.length;return n=(t+n)%e.length,e[n]}function P(n,r){if("."===n){if(j!==r)throw Error("Invalid path expression. Can only define '.' i the beginning of an expression.");return r}if(".."===n){if(d(r.parent))throw Error("Path expression out of bounds.");return r.parent}if(""===n){if(j!==r)throw Error("Invalid path expression.");return f}var t=n.match("^\\[(-?\\d+)\\]$");if(t){var e=Number(t[1]),a=[];if($(r.children,function(n){a.push(n)}),Math.abs(e)>=a.length)throw Error("Index out of bounds, index selecter must not exeed child count or negative childcount");return 0>e?a[a.length+e]:a[e]}if(n in r.children)return r.children[n];throw Error("Could find state for the lookup path.")}function O(n,r){var e=q.current;if(n=h(n)?l(a(n)):j,!n.route)return t;var i={},u=e&&e.$params&&e.$params.all||{};return $(n.route.params,function(n,r){r in u&&(i[r]=u[r])}),o.format(n.route.route,w(i,r||{}))}function S(r){h(r)?m(r)||v(r)?(A=a(r),0!==A.indexOf("root")&&(A="root."+A)):r&&(A=f.fullname):A=j.fullname,n.$evalAsync(function(){U({state:j,params:R,route:o.current})})}function y(n,r){function t(){var n={};return a.route&&$(a.route.params,function(t,e){n[e]=r[e]}),n}var e=[],a=n;do e.push({state:a,params:t()});while(a=a.parent);return e}function k(n,r,t,e){for(var a,o,i=y(n,t||{}),u=y(r,e),c=Math.max(i.length,u.length),l=!1,s=!x(t,e),f=0;c>f;f++)a=i[i.length-f-1],o=u[u.length-f-1],d(o)?u[0].isChanged=l=!0:o.isChanged=d(a)||A&&A==o.state.fullname||o.state.fullname!==a.state.fullname||!x(o.params,a.params)?l=!0:!1;return l=l||u[0].state.reloadOnOptional&&s,{array:u.reverse(),stateChanges:l,paramChanges:s}}function I(r,t,e){var a=q.current.$params;a.all=r,a.path=t,a.search=e,n.$broadcast("$stateUpdate",q.current)}function U(c){var f,d,v=c.params,x=c.route,C=l(a(c.state)),E=w({},C.self,{$params:v,$route:x}),P=q.current,O=u.find(q.current,E),S=!1,y=k(l(a(q.current)),C,P.$params&&P.$params.all,v&&v.all||{}),T={cancel:function(){S=!0},"goto":function(n,r){S=!0,U({state:n,params:{all:r},updateroute:!0})}};if(!A&&!y.stateChanges)return y.paramChanges&&I(v.all||{},v.path||{},v.search||{}),t;if(A=null,c.updateroute&&C.route){var N={},M=P.$params&&P.$params.all||{};$(C.route.params,function(n,r){r in M&&(N[r]=M[r])});var V=w(N,v&&v.all);return o.change(w({},C.route,{params:V})),t}if(O.before(T),!S){var F=n.$broadcast("$stateChangeStart",E,P);F.defaultPrevented||r.when(E).then(function(){function a(n){var t=[],a=[];angular.forEach(n||{},function(n,r){a.push(r),t.push(angular.isString(n)?e.get(n):e.invoke(n))});var o=r.defer();return r.all(t).then(function(n){angular.forEach(n,function(n,r){u[a[r]]=n}),o.resolve(u)}),o.promise}var o=!1,u={};f=i.beginUpdate(),i.clear();var c=r.when(0);return $(y.array,function(n){c=c.then(function(){return a(n.state.self.resolve)}).then(function(r){n.isChanged&&(o=!0),d=n.state.self.scrollTo,$(n.state.self.views,function(t,a){var u;t.sticky&&(u=t.sticky,p(u)||g(u)?u=e.invoke(u,u,{$to:E,$from:P}):m(u)||(u=n.state.fullname)),o||h(u)?i.setOrUpdate(a,t.template,t.controller,b(r),u):i.setIfAbsent(a,t.template,t.controller,b(r))})})}),c.then(function(){return O.between(T),S?(f.cancel(),t):(j=C,R=v,q.current=E,f.commit(),n.$broadcast("$stateChangeSuccess",E,P),t)})},function(r){f.cancel(),n.$broadcast("$stateChangeError",E,P,r)}).then(function(){S||(T.cancel=function(){throw Error("Can't cancel transition in after handler")},O.after(T),s(d))})}}var A=null,j=f,R={},q={root:f,current:w({},f.self),"goto":function(n,r){U({state:n,params:{all:r},updateroute:!0})},lookup:C,reload:S,url:O};return n.$on("$routeChangeSuccess",function(){var n,r=o.current;r?(n={all:r.params,path:r.pathParams,search:r.searchParams},r.state&&U({state:r.state,params:n,route:r})):U({state:f})}),n.$on("$routeUpdate",function(){var n=o.current;I(n.params,n.pathParams,n.searchParams)}),q}]}];angular.module("ui.routing").provider("$state",C),angular.module("ui.routing").provider("$template",s),angular.module("ui.routing").provider("$view",f);var E=["$anchorScrollProvider",function(){this.$get=["$window","$rootScope","$location","$anchorScroll","$injector",function(n,r,t,e,a){function i(n){n&&n.scrollIntoView()}function u(r){var t;d(r)?e():m(r)?"top"===r?n.scroll(0,0):i(angular.element(r)[0]):null!==(t=o(r))&&i(angular.element(a.invoke(r,t))[0])}return n.document,u}]}];angular.module("ui.routing").provider("$scroll",E);var P=["$state","$scroll","$compile","$controller","$view","$animator",function(n,r,t,e,a,o){return{restrict:"ECA",terminal:!0,link:function(n,r,i){function u(){s&&(s.$destroy(),s=null)}function c(n){n?v.leave(r.contents(),r):r.html(""),u()}function l(o){var i,u=a.get(f);if(u&&u.template){if(u.version===g)return;g=u.version,i=u.controller,u.template.then(function(a){c(o),o?v.enter(angular.element("<div></div>").html(a).contents(),r):r.html(a);var l,f=t(r.contents());s=n.$new(),i&&(l=b(u.locals),l.$scope=s,i=e(i,l),r.contents().data("$ngControllerController",i)),f(s),s.$emit("$viewContentLoaded"),s.$eval(m)})}else c(o)}var s,f=i.uiView||i.name,d=h(i.ngAnimate),m=i.onload||"",v=o(n,i),g=-1;n.$on("$viewChanged",function(n,r){r===f&&l(d)}),n.$on("$viewRefresh",function(n,r,t){r===f&&(p(s.refresh)?s.refresh(t):s.$broadcast("$refresh",r,t))}),n.$on("$stateChangeSuccess",function(){return l(d)}),l(!1)}}}];angular.module("ui.routing").directive("uiView",P)})(window,document);