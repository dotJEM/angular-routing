/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
var dotjem;(function(t,e,n,r){"use strict";function o(t,e){return w(new(w(function(){},{prototype:t})),e)}function a(t){return g(t)?t:t.$fullname||t.fullname}function i(t){if(v(t))return function(e,n){return e.invoke(t,t,n)};if(b(t)){var e=t[t.length-1];return function(n,r){return n.invoke(t,e,r)}}return null}function u(t,e,n){var r=C(t||{});return r.$all=C(t||{}),r.$path=C(e||{}),r.$search=C(n||{}),r}function c(t,e){var n=[];return E(t,function(t,e){n.push(s(e,!0)+(t===!0?"":"="+s(t,!0)))}),n.length?e+n.join("&"):""}function s(t,e){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,e?"%20":"+")}function l(t){return t.replace(S,"\\$&")}function f(){function t(t){var e={handler:{}};return d(t.to)&&(e.to=t.to),d(t.from)&&(e.from=t.from),d(t.handler)&&(e.handler=t.handler),d(t.before)&&m(e.handler.before)&&(e.handler.before=t.before),d(t.between)&&m(e.handler.between)&&(e.handler.between=t.between),d(t.after)&&m(e.handler.after)&&(e.handler.after=t.after),e}function e(t,e){var r=n(t),o=n(e);if(!r||!o){if(r)throw Error("Invalid transition - to: '"+e+"'.");if(o)throw Error("Invalid transition - from: '"+t+"'.");throw Error("Invalid transition - from: '"+t+"', to: '"+e+"'.")}}function n(t){return"*"===t||u.test(t)?!0:!1}function r(t){for(var e=o,n=t.split("."),r=n[0]===y?1:0;n.length>r;r++)n[r]in e.children||(e.children[n[r]]={children:{},targets:{}}),e=e.children[n[r]];return e}var o={children:{},targets:{}},u=/^\w+(\.\w+)*(\.[*])?$/;this.onEnter=function(e,n){if($(n)){var r=t(n);this.transition(r.from||"*",e,r.handler)}else(v(n)||b(n))&&this.transition("*",e,n)},this.onExit=function(e,n){if($(n)){var r=t(n);this.transition(e,r.to||"*",r.handler)}else(v(n)||b(n))&&this.transition(e,"*",n)},this.transition=function(t,n,o){var u,c=this;if(b(t))E(t,function(t){c.transition(t,n,o)});else if(b(n))E(n,function(e){c.transition(t,e,o)});else{if(t=a(t),n=a(n),n===t&&-1===n.indexOf("*"))return this;e(t,n),i(o)&&(o={between:o}),u=r(t),n in u.targets||(u.targets[n]=[]),o.name=t+" -> "+n,u.targets[n].push(o)}return this},this.$get=["$q","$injector",function(t,e){function n(t,n){function r(r,o){var a;E(u,function(u){d(a=r(u))&&i(a)(e,{$to:n,$from:t,$transition:o})})}var o=s(a(t)),u=c(o,a(n));return{before:function(t){r(function(t){return t.before},t)},between:function(t){r(function(t){return t.between},t)},after:function(t){r(function(t){return t.after},t)}}}function r(t){return t[0]===y&&t.splice(0,1),t}function u(t,e){for(var n,o,a=r(t.split(".")).reverse(),i=r(e.split(".")).reverse();;){if(n=a.pop(),o=i.pop(),"*"===o||"*"===n)return!0;if(n!==o)return!1;if(!d(n)||!d(o))return!0}return!0}function c(t,e){var n=[];return E(t,function(t){E(t.targets,function(t,r){u(r,e)&&E(t,function(t){n.push(t)})})}),n}function s(t){var e=o,n=t.split("."),r=[],a=n[0]===y?1:0;do{if("*"in e.children&&r.push(e.children["*"]),!(n[a]in e.children))break;e=e.children[n[a]],r.push(e)}while(a++<n.length);return r}var l={root:o,find:n};return l}]}function p(){var t=RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))","i");this.$get=["$http","$q","$injector","$templateCache",function(e,n,r,o){function a(t){return e.get(t,{cache:o}).then(function(t){return t.data})}function i(t){return n.when(r.invoke(t))}function u(t){if(d(t.url))return a(t.url);if(d(t.fn))return i(t.fn);if(d(t.html))return n.when(t.html);throw Error("Object must define url, fn or html.")}var c={get:function(e){if(g(e))return t.test(e)?a(e):n.when(e);if(v(e)||b(e))return i(e);if($(e))return u(e);throw Error("Template must be either an url as string, function or a object defining either url, fn or html.")}};return c}]}function h(){this.$get=["$rootScope","$q","$template",function(t,e,n){function r(t){return $(t)&&(d(t.template)||d(t.controller)||d(t.locals)||d(t.sticky))}function o(t){if(m(t))throw Error("Must define a view name.")}function a(e){t.$broadcast(O.VIEW_UPDATE,e)}function i(e,n){t.$broadcast(O.VIEW_REFRESH,e,n)}function u(e,n){t.$broadcast(O.VIEW_PREP,e,n)}function c(t,e){return e in t&&null!==t[e]}function s(t){return w.completed?(m(t)?E(b,function(t,e){C.clear(e)}):(delete b[t],a(t)),C):w.clear(t)}function l(t,e,u,s,l){var f=e;return r(e)&&(f=e.template,u=e.controller,s=e.locals,l=e.sticky),o(t),w.completed?(c(b,t)||(b[t]={version:-1}),b[t].template=n.get(f),b[t].controller=u,b[t].locals=s,d(l)&&g(l)&&b[t].sticky===l?i(t,{$locals:s,sticky:l}):(b[t].version++,b[t].sticky=l,a(t)),C):w.update(t,f,u,s,l)}function f(t,e,i,u){var s=e;return r(e)&&(s=e.template,i=e.controller,u=e.locals),o(t),w.completed?(c(b,t)||(b[t]={template:n.get(s),controller:i,locals:u,version:0},a(t)),C):w.create(t,s,i,u)}function p(t){return m(t)?b:b[t]}function h(t,e){return w.completed?(m(t)?E(b,function(t,n){C.refresh(n,e)}):(e.$locals=b[t]&&b[t].locals,i(t,e)),C):w.refresh(t,e)}function v(){function t(){var t,e={};return t={completed:!1,commit:function(){t.completed||(t.completed=!0,E(e,function(t){t.fn()}))},cancel:function(){u(name,{type:"cancel"}),t.completed=!0},clear:function(n){return m(n)?(E(b,function(e,n){t.clear(n)}),t):(e[n]={act:"clear",fn:function(){s(n)}},t)},prepUpdate:function(e,n,r,o){return u(e,{type:"update"}),function(a){return t.update(e,n,r,a,o),t}},prepCreate:function(e,n,r){return u(e,{type:"create"}),function(o){return t.create(e,n,r,o),t}},update:function(n,r,a,i,u){return o(n),e[n]={act:"update",fn:function(){l(n,r,a,i,u)}},t},create:function(n,r,a,i){return o(n),c(e,n)&&"clear"!==e[n].act||(e[n]={act:"create",fn:function(){f(n,r,a,i)}}),t},refresh:function(n,r){return m(n)?(E(b,function(e,n){t.refresh(n,r)}),t):(e[n]={act:"refresh",fn:function(){h(n,r)}},t)},get:p}}if(!w.completed)throw Error("Can't start multiple transactions");return w=t()}var b={},w={completed:!0},C={get:p,clear:s,refresh:h,update:l,create:f,beginUpdate:v};return C}]}angular.module("dotjem.routing",[]);var d=angular.isDefined,m=angular.isUndefined,v=angular.isFunction,g=angular.isString,$=angular.isObject,b=angular.isArray,E=angular.forEach,w=angular.extend,C=angular.copy,x=angular.equals,y=(angular.element,"$root"),S=/[-\/\\^$*+?.()|[\]{}]/g,_={routeCannotBeUndefined:"Can not set route to undefined.",valueCouldNotBeMatchedByRegex:"Value could not be matched by the regular expression parameter.",regexConverterNotValid:"The Regular-expression converter was not initialized with a valid object.",invalidNumericValue:"Value was not acceptable for a numeric parameter.",invalidBrowserPathExpression:"Invalid path expression.",expressionOutOfBounds:"Expression out of bounds.",couldNotFindStateForPath:"Could find state for path."},O={LOCATION_CHANGE:"$locationChangeSuccess",ROUTE_UPDATE:"$routeUpdate",ROUTE_CHANGE_START:"$routeChangeStart",ROUTE_CHANGE_SUCCESS:"$routeChangeSuccess",ROUTE_CHANGE_ERROR:"$routeChangeError",STATE_UPDATE:"$stateUpdate",STATE_CHANGE_START:"$stateChangeStart",STATE_CHANGE_SUCCESS:"$stateChangeSuccess",STATE_CHANGE_ERROR:"$stateChangeError",VIEW_UPDATE:"$viewUpdate",VIEW_REFRESH:"$viewRefresh",VIEW_PREP:"$viewPrep"},R=["$locationProvider",function(t){function e(t){var e=null;return function(n,r){return null===e&&(e=t?g(t)?function(e,n){var r=a(t,n.params);e.path(r).search(n.params).replace()}:function(e,n){e.url(t(n.pathParams,e.path(),e.search())).replace()}:function(){}),e(n,r)}}function n(t,e,n){var r;if(n&&(r=n.trim(),"{"===r[0]&&"}"===r[r.length-1]||"["===r[0]&&"]"===r[r.length-1]))try{n=angular.fromJson(r)}catch(o){}return{name:t,converter:function(){return h[e](n)}}}function a(t,e){var r="",o=0;return E(i(t),function(a){var i=function(t){return""+t},u=n(a.name,a.converter,a.args).converter(),c=e[a.name];if(m(c))throw Error("Could not find parameter '"+a.name+"' when building url for route '"+t+"', ensure that all required parameters are provided.");!v(u)&&d(u.format)&&(i=u.format),r+=t.slice(o,a.index)+"/"+i(c),o=a.lastIndex,delete e[a.name]}),r+=t.substr(o)}function i(t){var e,n=[];if(null===t)return n;for(;null!==(e=y.exec(t));)n.push({name:e[4]||e[11],catchAll:"*"===(e[3]||e[10]),converter:e[7]||"",args:e[9],index:e.index,lastIndex:y.lastIndex});return n}function u(t){var e="^",r="",o=[],a=0,u="",c={};return null===t?{name:null,params:c}:"/"===t?{exp:RegExp("^[/]?$",u),segments:[],name:r,params:c}:(E(i(t),function(i,u){var s="";e+=l(t.slice(a,i.index)),e+=i.catchAll?"/(.*)":"/([^\\/]*)",""!==i.converter&&(s=":"+i.converter),r+=t.slice(a,i.index)+"/$"+u+s,c[i.name]={id:u,converter:i.converter},o.push(n(i.name,i.converter,i.args)),a=i.lastIndex}),e+=l(t.substr(a)),r+=t.substr(a),x||(r=r.toLowerCase(),u+="i"),"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),{exp:RegExp(e+"/?$",u),segments:o,name:r,params:c})}function s(t,e){return null==t?function(){}:function(t){var n,o=t.match(e.exp),a={};return o&&(n=!1,E(e.segments,function(t,e){var r,i,u;n||(r=o[e+1],u=t.converter(),!v(u)&&d(u.parse)&&(u=u.parse),i=u(r),d(i.accept)?(i.accept||(n=!0),a[t.name]=i.value):(i||(n=!0),a[t.name]=r))}),!n)?a:r}}var f=this,p={},h={},b={},x=!0;this.convert=function(t,e){return h[t]=e,f},this.when=function(t,n){var r=u(t);return p[r.name]={self:w({reloadOnSearch:!0},n),redirect:e(n.redirectTo),match:s(t,r),params:r.params,path:t},{convert:f.convert,when:f.when,otherwise:f.otherwise,decorate:f.decorate,ignoreCase:f.ignoreCase,matchCase:f.matchCase,$route:{name:r.name,params:C(r.params),route:t}}},this.otherwise=function(t){return f.when(null,t),f},this.decorate=function(t,e){return b[t]=e,f},this.ignoreCase=function(){return x=!1,f},this.matchCase=function(){return x=!0,f};var y=RegExp("/((:(\\*?)(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\*?)(\\w+)\\}))","g");this.convert("num",function(){return{parse:function(t){var e=!isNaN(t);return{accept:e,value:e?Number(t):0}},format:function(t){if(isNaN(t))throw Error(_.invalidNumericValue);return""+t}}}),this.convert("regex",function(t){var e,n,r="";if($(t)&&d(t.exp))e=t.exp,d(t.flags)&&(r=t.flags);else{if(!(g(t)&&t.length>0))throw Error(_.regexConverterNotValid);e=t}return n=RegExp(e,r),{parse:function(t){var e=n.test(t);return{accept:e,value:e?n.exec(t):null}},format:function(t){var e=""+t,r=n.test(e);if(!r)throw Error(_.valueCouldNotBeMatchedByRegex);return e}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams","$browser",function(e,n,i,u,s,l){function f(t,e,n){var r=o(t,{self:o(t.self,{params:w({},n,e),searchParams:n,pathParams:e})});return r}function h(t){var e,r;return E(p,function(o){!r&&(e=o.match(t))&&(r=f(o,e,n.search()))}),r||p[null]&&f(p[null],{},{})}function d(){var t=h(n.path()),o=v.current,a=t?t.self:r;if(!m&&a&&o&&angular.equals(a.pathParams,o.pathParams)&&!a.reloadOnSearch)o.params=a.params,o.searchParams=a.searchParams,o.pathParams=a.pathParams,C(a.params,s),e.$broadcast(O.ROUTE_UPDATE,o);else if(t||o){m=!1;var c=e.$broadcast(O.ROUTE_CHANGE_START,a,o);if(!c.defaultPrevented){v.current=a,t&&t.redirect(n,a);var l=i.when(a);a&&E(b,function(t){l=l.then(function(){var e=u.invoke(t,a,{$next:a});return i.when(e)})}),l.then(function(){a===v.current&&(t&&angular.copy(a.params,s),e.$broadcast(O.ROUTE_CHANGE_SUCCESS,a,o))},function(t){a===v.current&&e.$broadcast(O.ROUTE_CHANGE_ERROR,a,o,t)})}}}var m=!1,v={routes:p,reload:function(){m=!0,e.$evalAsync(d)},change:function(t){var e=t.params||{},r=a(t.route,e),o=n.path(r).search(e||{});t.replace&&o.replace()},format:function(e,n){var n=n||{},r=a(e,n)+c(n,"?");return t.html5Mode()&&(r=(l.baseHref()+r).replace(/\/\//g,"/")),r}};return e.$on(O.LOCATION_CHANGE,d),v}]}];angular.module("dotjem.routing").provider("$route",R).value("$routeParams",{}),angular.module("dotjem.routing").provider("$stateTransition",f);var T=["$routeProvider","$stateTransitionProvider",function(t,e){var n=new I(t,e),r=n.createState(y,{}),o=new U(r);new N,this.state=function(t,e){H.validateName(t);var r=o.lookup(t,1);return r.add(n.createState(t,e,r)),this},this.$get=["$rootScope","$q","$injector","$route","$view","$stateTransition","$location","$scroll","$resolve",function(t,e,n,i,c,s,l,f,p){function h(e){d(e)?g(e)||$(e)?(b=a(e),0!==b.indexOf(y)&&(b=y+"."+b)):e&&(b=r.fullname):b=C.fullname,t.$evalAsync(function(){m({state:C,params:x.params,fource:b})})}function m(r){_.ended||_.abort();var u=_=S.next(function(t){S=t});if(u=u.execute(k.initializeContext(a(r.state),r.params,o)).execute(k.createEmitter(s)).execute(k.buildChanges(b)).execute(k.createTransition(m)).execute(function(){b=null}).execute(k.raiseUpdate(t)).execute(k.updateRoute(i,r.updateroute)).execute(k.beginTransaction(c,n)).execute(k.before()).execute(function(e){t.$broadcast(O.STATE_CHANGE_START,e.toState,x.current).defaultPrevented&&e.abort()}),!u.ended){var l,h=!1,d={},v=e.when("");E(u.changed.array,function(t){v=v.then(function(){return(h=h||t.isChanged)&&p.clear(t.state.resolve),p.all(t.state.resolve,d,{$to:u.toState,$from:x.current})}).then(function(e){u.completePrep(t.state.fullname,d=w({},d,e)),l=t.state.scrollTo})}),v.then(function(){u.execute(k.between(t)).execute(function(e){C=e.to;var n=x.current;x.params=e.params,x.current=e.toState,e.transaction.commit(),t.$broadcast(O.STATE_CHANGE_SUCCESS,e.toState,n)}).execute(k.after(f,l)).complete()},function(e){u.execute(function(n){t.$broadcast(O.STATE_CHANGE_ERROR,n.toState,x.current,e),n.abort()})})}}var v=new V(i),b=null,C=r,x={root:r,current:w(r.self,{$params:u()}),params:u(),"goto":function(t,e){m({state:t,params:u(e),updateroute:!0})},lookup:function(t){return o.resolve(C,t,!0)},reload:h,url:function(t,e){return t=d(t)?o.resolve(C,a(t),!1):C,v.buildUrl(x.current,t,e)},is:function(t){return C.is(a(t))},isActive:function(t){return C.isActive(a(t))}};t.$on(O.ROUTE_CHANGE_SUCCESS,function(){var t=i.current;t?t.state&&m({state:t.state,params:u(t.params,t.pathParams,t.searchParams)}):m({state:r,params:u()})}),t.$on(O.ROUTE_UPDATE,function(){var e=i.current,n=u(e.params,e.pathParams,e.searchParams);x.params=n,x.current.$params=n,t.$broadcast(O.STATE_UPDATE,x.current)});var S=new B(x,function(){},r).complete(),_=S;return x}]}];angular.module("dotjem.routing").provider("$state",T);var A=[function(){this.$get=["$q","$injector",function(t,e){var n={},r={};return n.push=function(t,e){r[t]=e},n.clear=function(t){m(t)&&(r={}),g(t)?delete r[t]:$(t)?angular.forEach(t,function(t,e){n.clear(e)}):b(t)&&angular.forEach(t,function(t){n.clear(t)})},n.all=function(n,o,a){var u=[],c=[],s=t.defer();return angular.forEach(n,function(t,n){var l;c.push(n);try{n in r||(g(t)?r[n]=angular.isString(t):null!=(l=i(t))&&(r[n]=l(e,w({},o,a)))),u.push(r[n])}catch(f){s.reject("Could not resolve "+n)}}),t.all(u).then(function(t){var e={};angular.forEach(t,function(t,n){e[c[n]]=t}),s.resolve(e)},function(t){s.reject(t)}),s.promise},n}]}];angular.module("dotjem.routing").provider("$resolve",A),angular.module("dotjem.routing").provider("$template",p),angular.module("dotjem.routing").provider("$view",h);var P=[function(){this.$get=["$window","$rootScope","$anchorScroll","$injector",function(t,e,n,o){function a(n){return u.$current=n,"top"===n?(t.scrollTo(0,0),r):(e.$broadcast("$scrollPositionChanged",n),r)}var u=function(t){var e;m(t)?n():g(t)?a(t):null!==(e=i(t))&&a(e(o))};return u.$current="top",u}]}];angular.module("dotjem.routing").provider("$scroll",P);var j=function(){function t(t,e,n,r){this._name=t,this._fullname=e,this._parent=r,this._children={},this._self=n,this._self.$fullname=e,this._reloadOnOptional=!d(n.reloadOnSearch)||n.reloadOnSearch,this._scrollTo=this._self.scrollTo||r&&r.scrollTo||"top"}return Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullname",{get:function(){return this._fullname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloadOnOptional",{get:function(){return this._reloadOnOptional},set:function(t){this._reloadOnOptional=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"self",{get:function(){return C(this._self)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"route",{get:function(){return this._route},set:function(t){if(m(t))throw Error(_.routeCannotBeUndefined);this._route=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return null===this.parent?this:this._parent.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollTo",{get:function(){return this._scrollTo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return this.self.views},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolve",{get:function(){return this.self.resolve},enumerable:!0,configurable:!0}),t.prototype.add=function(t){return this._children[t.name]=t,this},t.prototype.resolveRoute=function(){return d(this.route)?this.route.route:d(this.parent)?this.parent.resolveRoute():""},t.prototype.is=function(t){return this.fullname===t||this.fullname===y+"."+t},t.prototype.isActive=function(t){return this.is(t)?!0:this.parent&&this.parent.isActive(t)||!1},t}(),U=function(){function t(t){this.root=t,this.nameRegex=RegExp("^("+l(y)+"\\.)?\\w+(\\.\\w+)*$"),this.siblingRegex=RegExp("^\\$node\\(([-+]?\\d+)\\)$"),this.indexRegex=RegExp("^\\[(-?\\d+)\\]$")}return t.prototype.lookup=function(t,e){for(var n=this.root,r=t.split("."),o=r[0]===y?1:0,e=d(e)?e:0;r.length-e>o;o++){if(!(r[o]in n.children))throw Error("Could not locate '"+r[o]+"' under '"+n.fullname+"'.");n=n.children[r[o]]}return n},t.prototype.resolve=function(t,e,n){var r,o=this,a=this.siblingRegex.exec(e),i=t;if(a?i=this.selectSibling(Number(a[1]),i):this.nameRegex.test(e)?i=this.lookup(e):(r=e.split("/"),E(r,function(e){i=o.select(t,e,i)})),i===this.root)throw Error(_.expressionOutOfBounds);return i&&n?C(i.self):i},t.prototype.selectSibling=function(t,e){var n=[],r=0;for(E(e.parent.children,function(t){n.push(t),e.fullname===t.fullname&&(r=n.length-1)});0>t;)t+=n.length;return t=(r+t)%n.length,n[t]},t.prototype.select=function(t,e,n){if("."===e){if(t!==n)throw Error(_.invalidBrowserPathExpression);return n}if(".."===e){if(m(n.parent))throw Error(_.expressionOutOfBounds);return n.parent}if(""===e){if(t!==n)throw Error(_.invalidBrowserPathExpression);return this.root}var r=this.indexRegex.exec(e);if(r){var o=Number(r[1]),a=[];if(E(n.children,function(t){a.push(t)}),Math.abs(o)>=a.length)throw Error(_.expressionOutOfBounds);return 0>o?a[a.length+o]:a[o]}if(e in n.children)return n.children[e];throw Error(_.couldNotFindStateForPath+": "+e)},t}(),N=function(){function t(){}return t.prototype.buildStateArray=function(t,e){function n(){var t={};return o.route&&E(o.route.params,function(n,r){t[r]=e[r]}),t}var r=[],o=t;do r.push({state:o,params:n()});while(o=o.parent);return r},t.prototype.compare=function(t,e,n,r,o){for(var a,i,u=this.buildStateArray(t,n||{}),c=this.buildStateArray(e,r),s=Math.max(u.length,c.length),l=!1,f=!x(n,r),p=0;s>p;p++)a=u[u.length-p-1],i=c[c.length-p-1],m(i)?c[0].isChanged=l=!0:i.isChanged=m(a)||o===i.state.fullname||i.state.fullname!==a.state.fullname||!x(i.params,a.params)?l=!0:!1;return l=l||c[0].state.reloadOnOptional&&f,{array:c.reverse(),stateChanges:l,paramChanges:f}},t}(),I=function(){function t(t,e){this.routes=t,this.transitions=e}return t.prototype.createRoute=function(t,e,n,r){var o=e||"";return""!==o&&"/"===o[o.length-1]&&(o=o.substr(0,o.length-1)),"/"!==t[0]&&""!==t&&(o+="/"),o+=t,this.routes.when(o,{state:n,reloadOnSearch:r})},t.prototype.createState=function(t,e,n){var r=this,o=t.split(".").pop();d(n)&&(t=n.fullname+"."+o);var a=new j(o,t,e,n);return a.reloadOnOptional=!d(e.reloadOnSearch)||e.reloadOnSearch,d(e.route)&&(a.route=this.createRoute(e.route,n.resolveRoute(),a.fullname,a.reloadOnOptional).$route),d(e.onEnter)&&this.transitions.onEnter(a.fullname,e.onEnter),d(e.onExit)&&this.transitions.onExit(a.fullname,e.onExit),d(e.children)&&E(e.children,function(t,e){a.add(r.createState(a.fullname+"."+e,t,a))}),a},t}(),H=function(){function t(){}return t.nameValidation=/^\w+(\.\w+)*?$/,t.validateName=function(e){if(!t.nameValidation.test(e)||e===y)throw Error("Invalid name: '"+e+"'.")},t}(),V=function(){function t(t){this.route=t}return t.prototype.buildUrl=function(t,e,n){var r=t;if(!e.route)throw Error("Can't build url for a state that doesn't have a url defined.");var o={},a=r&&r.$params.$all||{};return E(e.route.params,function(t,e){e in a&&(o[e]=a[e])}),this.route.format(e.route.route,w(o,n||{}))},t}(),k={initializeContext:function(t,e,n){return function(r){var o=n.resolve(r.from,t,!1);r.to=o,r.params=e,r.toState=w({},o.self,{$params:e})}},createEmitter:function(t){return function(e){e.emit=t.find(e.$state.current,e.toState)}},buildChanges:function(t){return function(e){e.changed=(new N).compare(e.from,e.to,e.$state.params,e.params,t)}},createTransition:function(t){return function(e){var n={canceled:!1,cancel:function(){n.canceled=!0},"goto":function(e,r){n.canceled=!0,t({state:e,params:{all:r},updateroute:!0})}};e.transition=n}},raiseUpdate:function(t){return function(e){var n=e.changed,r=e.$state;n.stateChanges||(n.paramChanges&&(r.params=e.params,r.current.$params=e.params,t.$broadcast("$stateUpdate",r.current)),e.abort())}},updateRoute:function(t,e){return function(n){var r=n.to.route;if(e&&r){var o={},a=n.$state.params.$all;E(r.params,function(t,e){e in a&&(o[e]=a[e])});var i=w(o,n.params.$all);t.change(w({},r,{params:i})),n.abort()}}},before:function(){return function(t){t.emit.before(t.transition),t.transition.canceled&&t.abort()}},between:function(t){return function(e){e.emit.between(e.transition),e.transition.canceled&&(t.$broadcast("$stateChangeAborted",e.toState,e.$state.current),e.abort())}},after:function(t,e){return function(n){n.transition.canceled||(n.transition.cancel=function(){throw Error("Can't cancel transition in after handler")},n.emit.after(n.transition),t(e))}},beginTransaction:function(t,e){return function(n){n.transaction=t.beginUpdate(),n.transaction.clear();var r=!1;E(n.changed.array,function(t){r=r||t.isChanged,E(t.state.views,function(o,a){var u,c;(u=o.sticky)&&((c=i(u))?u=c(e,{$to:n.toState,$from:n.$state.current}):g(u)||(u=t.state.fullname)),r||o.force||d(u)?n.prepUpdate(t.state.fullname,a,o.template,o.controller,u):n.prepCreate(t.state.fullname,a,o.template,o.controller)})})}}},B=function(){function t(t,e,n){this.aborted=!1,this.completed=!1,this._prep={},this._$state=t,this.to=n,this.onComplete=e}return Object.defineProperty(t.prototype,"$state",{get:function(){return this._$state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this.aborted||this.completed},enumerable:!0,configurable:!0}),t.prototype.next=function(e){this.ended||this.abort();var n=new t(this.$state,e);return n.previous=this,n.from=this.to,this.previous=null,n},t.prototype.execute=function(t){return!this.ended&&(t(this),this.aborted)?this.previous:this},t.prototype.complete=function(){return this.ended||(this.onComplete(this),this.completed=!0),this},t.prototype.abort=function(){return this.ended||(this.aborted=!0,this.transaction&&!this.transaction.completed&&this.transaction.cancel()),this},t.prototype.prepUpdate=function(t,e,n,r,o){var a=this._prep[t]=this._prep[t]||{};a[e]=this.transaction.prepUpdate(e,n,r,o)},t.prototype.prepCreate=function(t,e,n,r){var o=this._prep[t]=this._prep[t]||{};o[e]=this.transaction.prepCreate(e,n,r)},t.prototype.completePrep=function(t,e){E(this._prep[t],function(t){t(e)})},t}(),G=["$state","$scroll","$compile","$controller","$view","$animator","$template",function(t,e,n,o,a,i,u){return{restrict:"ECA",terminal:!0,link:function(t,e,c){function s(){d(g)&&(g.remove(),g=r,e.contents().show())}function l(){null!==y&&y.then(function(t){e.contents().hide(),e.append(g=angular.element(t))})}function f(){m&&(m.$destroy(),m=null)}function p(t){t?w.leave(e.contents(),e):e.html(""),f()}function h(r){var i,u=a.get($);if(u&&u.template){if(u.version===x)return;x=u.version,i=u.controller,u.template.then(function(a){p(r),r?w.enter(angular.element("<div></div>").html(a).contents(),e):e.html(a);var c,s=n(e.contents());m=t.$new(),i&&(c=C(u.locals),c.$scope=m,i=o(i,c),e.contents().data("$ngControllerController",i)),s(m),m.$emit("$viewContentLoaded"),m.$eval(E)})}else x=-1,p(r)}var m,g,$=c.jemView||c.name,b=d(c.ngAnimate),E=c.onload||"",w=i(t,c),x=-1,y=c.loader&&u.get(c.loader)||null;t.$on(O.VIEW_UPDATE,function(t,e){e===$&&h(b)}),t.$on(O.VIEW_REFRESH,function(t,e,n){e===$&&(v(m.refresh)?m.refresh(n):m.$broadcast("$refresh",e,n))}),t.$on("$viewPrep",function(t,e,n){e===$&&"update"===n.type?l():"cancel"===n.type&&s()}),h(!1)}}}];angular.module("dotjem.routing").directive("jemView",G);var q=["$scroll","$timeout",function(t,e){return{restrict:"ECA",terminal:!1,link:function(n,r,o){function a(t){t===i&&e(function(){r[0].scrollIntoView()},u)}var i=o.jemAnchor||o.id,u=d(o.delay)?Number(o.delay):1;n.$on("$scrollPositionChanged",function(t,e){a(e)}),a(t.$current)}}}];angular.module("dotjem.routing").directive("jemAnchor",q),angular.module("dotjem.routing").directive("id",q),n.State=j,n.StateBrowser=U,n.StateComparer=N,n.StateFactory=I,n.StateRules=H,n.StateUrlBuilder=V,n.RootName=y})(window,document,dotjem||(dotjem={}));