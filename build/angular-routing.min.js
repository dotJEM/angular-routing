/**
 * @license dotJEM Angular Routing
 * (c) 2012-2013 dotJEM (Jens Melgaard)
 * License: MIT
 *
 * @module angular-routing
 */
(function(t,n,e){"use strict";function r(t,n){return w(new(w(function(){},{prototype:t})),n)}function a(t){return m(t)?t:t.$fullname||t.fullname}function o(t){if(g(t))for(var n=0;t.length>n;n++){if(t.length-1>n&&!m(t[n]))return null;if(n===t.length-1&&d(t[n]))return t[n]}return null}function i(t){var n=[];return $(t,function(t,e){n.push(u(e,!0)+(t===!0?"":"="+u(t,!0)))}),n.length?n.join("&"):""}function u(t,n){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,n?"%20":"+")}function c(){function t(t){var n=null;return function(e,r){return null===n&&(n=t?m(t)?function(n,e){var r=a(t,e.params);n.path(r).search(e.params).replace()}:function(n,e){n.url(t(e.pathParams,n.path(),n.search())).replace()}:function(){}),n(e,r)}}function n(t,n,e){var r;if(e&&(r=e.trim(),"{"===r[0]&&"}"===r[r.length-1]||"["===r[0]&&"]"===r[r.length-1]))try{e=angular.fromJson(r)}catch(a){}return{name:t,converter:function(){return p[n](e)}}}function a(t,n){var e="",r=0;return $(u(t),function(a){""!==a.converter,e+=t.slice(r,a.index)+"/"+(""+n[a.name]),r=a.lastIndex,delete n[a.name]}),e+=t.substr(r)}function o(t){return t.replace(x,"\\$&")}function u(t){var n,e=[];if(null===t)return e;for(;null!==(n=y.exec(t));)e.push({name:n[3]||n[9],converter:n[6]||"",args:n[8],index:n.index,lastIndex:y.lastIndex});return e}function c(t){var e="^",r="",a=[],i=0,c="",l={};return null===t?{name:null,params:l}:"/"===t?{exp:RegExp("^[/]?$",c),segments:[],name:r,params:l}:($(u(t),function(u,c){var s="";e+=o(t.slice(i,u.index)),e+="/([^\\/]*)",""!==u.converter&&(s=":"+u.converter),r+=t.slice(i,u.index)+"/$"+c+s,l[u.name]={id:c,converter:u.converter},a.push(n(u.name,u.converter,u.args)),i=u.lastIndex}),e+=o(t.substr(i)),r+=t.substr(i),g||(r=r.toLowerCase(),c+="i"),"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),{exp:RegExp(e+"/?$",c),segments:a,name:r,params:l})}function l(t,n){return null==t?function(){}:function(t){var r,a=t.match(n.exp),o={};return a&&(r=!1,$(n.segments,function(t,n){var e,i;r||(e=a[n+1],i=t.converter()(e),h(i.accept)?(i.accept||(r=!0),o[t.name]=i.value):(i||(r=!0),o[t.name]=e))}),!r)?o:e}}var s=this,f={},p={},d={},g=!0;this.convert=function(t,n){return p[t]=n,s},this.when=function(n,e){var r=c(n);return f[r.name]={self:w({reloadOnSearch:!0},e),redirect:t(e.redirectTo),match:l(n,r),params:r.params,path:n},{convert:s.convert,when:s.when,otherwise:s.otherwise,decorate:s.decorate,ignoreCase:s.ignoreCase,matchCase:s.matchCase,$route:{name:r.name,params:b(r.params),route:n}}},this.otherwise=function(t){return s.when(null,t),s},this.decorate=function(t,n){return d[t]=n,s},this.ignoreCase=function(){return g=!1,s},this.matchCase=function(){return g=!0,s};var x=/[-\/\\^$*+?.()|[\]{}]/g,y=RegExp("/((:(\\w+))|(\\{((\\w+)(\\((.*?)\\))?:)?(\\w+)\\}))","g");this.convert("num",function(){return function(t){var n=!isNaN(t);return{accept:n,value:n?Number(t):0}}}),this.convert("regex",function(t){var n,e,r="";if(v(t)&&h(t.exp))n=t.exp,h(t.flags)&&(r=t.flags);else{if(!(m(t)&&t.length>0))throw Error("The Regular-expression converter was not initialized with a valid object.");n=t}return e=RegExp(n,r),function(t){var n=e.test(t);return{accept:n,value:n?e.exec(t):null}}}),this.convert("",function(){return function(){return!0}}),this.$get=["$rootScope","$location","$q","$injector","$routeParams",function(t,n,o,u,c){function l(t,n,e){var a=r(t,{self:r(t.self,{params:w({},e,n),searchParams:e,pathParams:n})});return a}function s(t){var e,r;return $(f,function(a){!r&&(e=a.match(t))&&(r=l(a,e,n.search()))}),r||f[null]&&l(f[null],{},{})}function h(){var r=s(n.path()),a=m.current,i=r?r.self:e;if(!p&&i&&a&&angular.equals(i.pathParams,a.pathParams)&&!i.reloadOnSearch)a.params=r.params,a.searchParams=r.searchParams,a.pathParams=r.pathParams,b(i.params,c),t.$broadcast("$routeUpdate",a);else if(r||a){p=!1;var l=t.$broadcast("$routeChangeStart",i,a);if(!l.defaultPrevented){m.current=i,r&&r.redirect(n,i);var f=o.when(i);i&&$(d,function(t){f=f.then(function(){var n=u.invoke(t,i,{$next:i});return o.when(n)})}),f.then(function(){i===m.current&&(r&&angular.copy(i.params,c),t.$broadcast("$routeChangeSuccess",i,a))},function(n){i===m.current&&t.$broadcast("$routeChangeError",i,a,n)})}}}var p=!1,m={routes:f,reload:function(){p=!0,t.$evalAsync(h)},change:function(t){var e=t.params||{},r=a(t.route,e),o=n.path(r).search(e||{});t.replace&&o.replace()},format:function(t,n){var n=n||{};return a(t,n)+i(n)}};return t.$on("$locationChangeSuccess",h),m}]}function l(){function t(t){var n={handler:{}};return h(t.to)&&(n.to=t.to),h(t.from)&&(n.from=t.from),h(t.handler)&&(n.handler=t.handler),h(t.before)&&p(n.handler.before)&&(n.handler.before=t.before),h(t.between)&&p(n.handler.between)&&(n.handler.between=t.between),h(t.after)&&p(n.handler.after)&&(n.handler.after=t.after),n}function n(t,n){var r=e(t),a=e(n);if(!r||!a){if(r)throw Error("Invalid transition - to: '"+n+"'.");if(a)throw Error("Invalid transition - from: '"+t+"'.");throw Error("Invalid transition - from: '"+t+"', to: '"+n+"'.")}}function e(t){return"*"===t||i.test(t)?!0:!1}function r(t){for(var n=o,e=t.split("."),r="root"===e[0]?1:0;e.length>r;r++)e[r]in n.children||(n.children[e[r]]={children:{},targets:{}}),n=n.children[e[r]];return n}var o={children:{},targets:{}},i=/^\w+(\.\w+)*(\.[*])?$/,u=this;this.onEnter=function(n,e){if(v(e)){var r=t(e);this.transition(r.from||"*",n,r.handler)}else(d(e)||g(e))&&this.transition("*",n,e)},this.onExit=function(n,e){if(v(e)){var r=t(e);this.transition(n,r.to||"*",r.handler)}else(d(e)||g(e))&&this.transition(n,"*",e)},this.transition=function(t,e,o){var i,u=this;if(g(t))$(t,function(t){u.transition(t,e,o)});else if(g(e))$(e,function(n){u.transition(t,n,o)});else{if(t=a(t),e=a(e),e===t&&-1===e.indexOf("*"))return this;n(t,e),(angular.isFunction(o)||angular.isArray(o))&&(o={between:o}),i=r(t),e in i.targets||(i.targets[e]=[]),o.name=t+" -> "+e,i.targets[e].push(o)}return this},this.$get=["$q","$injector",function(t,n){function e(t,e){function r(r,a){var o;$(i,function(i){h(o=r(i))&&n.invoke(o,u,{$to:e,$from:t,$transition:a})})}var o=l(a(t)),i=c(o,a(e));return{before:function(t){r(function(t){return t.before},t)},between:function(t){r(function(t){return t.between},t)},after:function(t){r(function(t){return t.after},t)}}}function r(t){return"root"===t[0]&&t.splice(0,1),t}function i(t,n){for(var e,a,o=r(t.split(".")).reverse(),i=r(n.split(".")).reverse();;){if(e=o.pop(),a=i.pop(),"*"===a||"*"===e)return!0;if(e!==a)return!1;if(!h(e)||!h(a))return!0}return!0}function c(t,n){var e=[];return $(t,function(t){$(t.targets,function(t,r){i(r,n)&&$(t,function(t){e.push(t)})})}),e}function l(t){var n=o,e=t.split("."),r=[],a="root"===e[0]?1:0;do{if("*"in n.children&&r.push(n.children["*"]),!(e[a]in n.children))break;n=n.children[e[a]],r.push(n)}while(a++<e.length);return r}var s={root:o,find:e};return s}]}function s(){var t=RegExp("^(((http|https|ftp)://([\\w-\\d]+\\.)+[\\w-\\d]+){0,1}(/?[\\w~,;\\-\\./?%&+#=]*))","i");this.$get=["$http","$q","$injector","$templateCache",function(n,e,r,a){function o(t){return n.get(t,{cache:a}).then(function(t){return t.data})}function i(t){return e.when(r.invoke(t))}function u(t){if(h(t.url))return o(t.url);if(h(t.fn))return i(t.fn);if(h(t.html))return e.when(t.html);throw Error("Object must define url, fn or html.")}return this.get=function(n){if(m(n))return t.test(n)?o(n):e.when(n);if(d(n)||g(n))return i(n);if(v(n))return u(n);throw Error("Template must be either an url as string, function or a object defining either url, fn or html.")},this}]}function f(){this.$get=["$rootScope","$q","$template",function(t,n,r){function a(t){if("undefined"===t)throw Error("Must define a view name.")}function o(n){t.$broadcast("$viewUpdate",n)}function i(n,e){t.$broadcast("$viewRefresh",n,e)}function u(t,n){return n in t&&null!==t[n]}function c(t){return v(t)&&(h(t.template)||h(t.controller)||h(t.locals)||h(t.sticky))}var l={},s=null;return this.clear=function(t){var n=this;if(p(t))$(l,function(t,e){n.clear(e)});else{if(s)return s.records[t]={act:"clear",fn:function(){n.clear(t)}},e;delete l[t],o(t)}},this.setOrUpdate=function(t,n,f,p,d){var v=this,g=n;return c(n)&&(g=n.template,f=n.controller,p=n.locals,d=n.sticky),a(t),s?(s.records[t]={act:"setOrUpdate",fn:function(){v.setOrUpdate(t,g,f,p,d)}},e):(u(l,t)||(l[t]={version:-1}),l[t].template=r.get(g),l[t].controller=f,l[t].locals=p,h(d)&&m(d)&&l[t].sticky===d?i(t,{sticky:!0}):(l[t].version++,l[t].sticky=d,o(t)),e)},this.setIfAbsent=function(t,n,i,f){var h=this,p=n;return c(n)&&(p=n.template,i=n.controller,f=n.locals),a(t),s?(u(s.records,t)&&"clear"!==s.records[t].act||(s.records[t]={act:"setIfAbsent",fn:function(){h.setIfAbsent(t,p,i,f)}}),e):(u(l,t)||(l[t]={template:r.get(p),controller:i,locals:f,version:0},o(t)),e)},this.get=function(t){return p(t)?l:l[t]},this.refresh=function(t,n){var r=this;if(p(t))$(l,function(t,n){r.clear(n)});else{if(s)return s.records[t]={act:"refresh",fn:function(){r.refresh(t,n)}},e;i(t,n)}},this.beginUpdate=function(){if(s)throw Error("Can't start multiple transactions");var t=s={records:{}};return{commit:function(){s=null,$(t.records,function(t){t.fn()})},cancel:function(){s=null}}},this}]}var h=angular.isDefined,p=angular.isUndefined,d=angular.isFunction,m=angular.isString,v=angular.isObject,g=angular.isArray,$=angular.forEach,w=angular.extend,b=angular.copy,x=angular.equals;angular.element,angular.module("ui.routing",[]),angular.module("ui.routing").provider("$route",c).value("$routeParams",{}),angular.module("ui.routing").provider("$stateTransition",l);var y=["$routeProvider","$stateTransitionProvider",function(t,n){function r(t){if(!y.test(t))throw Error("Invalid name: '"+t+"'.")}function o(n,e,r,a){var o;return o=e||"",""!==o&&"/"===o[o.length-1]&&(o=o.substr(0,o.length-1)),"/"!==n[0]&&""!==n&&(o+="/"),o+=n,t.when(o,{state:r,reloadOnSearch:a})}function i(t){for(;h(t)&&!h(t.route);)t=t.parent;return t&&t.route.route||""}function u(t,e,r){var a=e.fullname+"."+t,c=e;h(e.children)||(e.children={}),t in e.children||(e.children[t]={}),e=e.children[t],e.self=w({},r,{$fullname:a}),e.fullname=a,e.parent=c,e.reloadOnOptional=!h(r.reloadOnSearch)||r.reloadOnSearch,h(r.route)&&(e.route=o(r.route,i(c),a,e.reloadOnOptional).$route),h(r.onEnter)&&n.onEnter(a,r.onEnter),h(r.onExit)&&n.onExit(a,r.onExit),null===r.children?e.children={}:$(r.children,function(t,n){u(n,e,t)})}function c(t){for(var n=f,e="root"===t[0]?1:0;t.length>e;e++){if(!(t[e]in n.children))throw Error("Could not locate '"+t[e]+"' under '"+n.fullname+"'.");n=n.children[t[e]]}return n}function l(t){return c(t.split("."))}function s(t){var n=t.split("."),t=n.pop();return{at:c(n),name:t}}var f={fullname:"root",children:{},self:{$fullname:"root"},reloadOnOptional:!0},y=/^\w+(\.\w+)*?$/,C=new E.routing.StateClass("root",{});E.routing.StateFactory.Initialize(t,n),this.stateObj=function(t,n){var e=C.lookup(t.split("."),1);e.add(t,E.routing.StateFactory.instance.createState(t,n,e))},this.state=function(t,n){var e;return r(t),e=s(t),u(e.name,e.at,n),this},this.$get=["$rootScope","$q","$injector","$route","$view","$stateTransition","$location","$scroll",function(t,n,r,o,i,u,c,s){function y(t){var n,r=t.match("^\\$node\\(([-+]?\\d+)\\)$"),a=R;if(r?a=E(Number(r[1]),a):(n=t.split("/"),$(n,function(t){a=C(t,a)})),a===f)throw Error("Path expression out of bounds.");return a&&w({},a.self)||e}function E(t,n){var e,r=[];for($(n.parent.children,function(t){r.push(t),n.fullname===t.fullname&&(e=r.length-1)});0>t;)t+=r.length;return t=(e+t)%r.length,r[t]}function C(t,n){if("."===t){if(R!==n)throw Error("Invalid path expression. Can only define '.' i the beginning of an expression.");return n}if(".."===t){if(p(n.parent))throw Error("Path expression out of bounds.");return n.parent}if(""===t){if(R!==n)throw Error("Invalid path expression.");return f}var e=t.match("^\\[(-?\\d+)\\]$");if(e){var r=Number(e[1]),a=[];if($(n.children,function(t){a.push(t)}),Math.abs(r)>=a.length)throw Error("Index out of bounds, index selecter must not exeed child count or negative childcount");return 0>r?a[a.length+r]:a[r]}if(t in n.children)return n.children[t];throw Error("Could find state for the lookup path.")}function O(t,n){var e=A.current;if(t=h(t)?l(a(t)):R,!t.route)throw Error("Can't build url for a state that doesn't have a url defined.");var r={},i=e&&e.$params&&e.$params.all||{};return $(t.route.params,function(t,n){n in i&&(r[n]=i[n])}),o.format(t.route.route,w(r,n||{}))}function S(n){h(n)?m(n)||v(n)?(_=a(n),0!==_.indexOf("root")&&(_="root."+_)):n&&(_=f.fullname):_=R.fullname,t.$evalAsync(function(){j({state:R,params:U,route:o.current})})}function P(t,n){function e(){var t={};return a.route&&$(a.route.params,function(e,r){t[r]=n[r]}),t}var r=[],a=t;do r.push({state:a,params:e()});while(a=a.parent);return r}function k(t,n,e,r){for(var a,o,i=P(t,e||{}),u=P(n,r),c=Math.max(i.length,u.length),l=!1,s=!x(e,r),f=0;c>f;f++)a=i[i.length-f-1],o=u[u.length-f-1],p(o)?u[0].isChanged=l=!0:o.isChanged=p(a)||_&&_==o.state.fullname||o.state.fullname!==a.state.fullname||!x(o.params,a.params)?l=!0:!1;return l=l||u[0].state.reloadOnOptional&&s,{array:u.reverse(),stateChanges:l,paramChanges:s}}function I(n,e,r){var a=A.current.$params;a.all=n,a.path=e,a.search=r,t.$broadcast("$stateUpdate",A.current)}function j(c){var f,p,v=c.params,x=c.route,y=l(a(c.state)),E=w({},y.self,{$params:v,$route:x}),C=A.current,O=u.find(A.current,E),S=!1,P=k(l(a(A.current)),y,C.$params&&C.$params.all,v&&v.all||{}),q={cancel:function(){S=!0},"goto":function(t,n){S=!0,j({state:t,params:{all:n},updateroute:!0})}};if(!_&&!P.stateChanges)return P.paramChanges&&I(v.all||{},v.path||{},v.search||{}),e;if(_=null,c.updateroute&&y.route){var T={},F=C.$params&&C.$params.all||{};$(y.route.params,function(t,n){n in F&&(T[n]=F[n])});var L=w(T,v&&v.all);return o.change(w({},y.route,{params:L})),e}if(O.before(q),!S){var N=t.$broadcast("$stateChangeStart",E,C);N.defaultPrevented||n.when(E).then(function(){function a(t){var e=[],a=[];angular.forEach(t||{},function(t,n){a.push(n),e.push(angular.isString(t)?r.get(t):r.invoke(t))});var o=n.defer();return n.all(e).then(function(t){angular.forEach(t,function(t,n){u[a[n]]=t}),o.resolve(u)}),o.promise}var o=!1,u={};f=i.beginUpdate(),i.clear();var c=n.when(0);return $(P.array,function(t){c=c.then(function(){return a(t.state.self.resolve)}).then(function(n){t.isChanged&&(o=!0),p=t.state.self.scrollTo,$(t.state.self.views,function(e,a){var u;e.sticky&&(u=e.sticky,d(u)||g(u)?u=r.invoke(u,u,{$to:E,$from:C}):m(u)||(u=t.state.fullname)),o||h(u)?i.setOrUpdate(a,e.template,e.controller,b(n),u):i.setIfAbsent(a,e.template,e.controller,b(n))})})}),c.then(function(){return O.between(q),S?(f.cancel(),e):(R=y,U=v,A.current=E,f.commit(),t.$broadcast("$stateChangeSuccess",E,C),e)})},function(n){f.cancel(),t.$broadcast("$stateChangeError",E,C,n)}).then(function(){S||(q.cancel=function(){throw Error("Can't cancel transition in after handler")},O.after(q),s(p))})}}var _=null,R=f,U={},A={root:f,current:w({},f.self),"goto":function(t,n){j({state:t,params:{all:n},updateroute:!0})},lookup:y,reload:S,url:O};return t.$on("$routeChangeSuccess",function(){var t,n=o.current;n?(t={all:n.params,path:n.pathParams,search:n.searchParams},n.state&&j({state:n.state,params:t,route:n})):j({state:f})}),t.$on("$routeUpdate",function(){var t=o.current;I(t.params,t.pathParams,t.searchParams)}),A}]}];angular.module("ui.routing").provider("$state",y);var E;(function(t){(function(t){var n=function(){function t(t,n){this.routes=t,this.transitions=n}return Object.defineProperty(t,"instance",{get:function(){return t._instance},enumerable:!0,configurable:!0}),t.Initialize=function(n,e){t._instance=new t(n,e)},t.prototype.createRoute=function(t,n,e,r){var a;return""!==a&&"/"===a[a.length-1]&&(a=a.substr(0,a.length-1)),"/"!==t[0]&&""!==t&&(a+="/"),a+=t,this.routes.when(a,{state:e,reloadOnSearch:r})},t.prototype.createState=function(t,n,r){var a=new e(t,n,r);return h(n.route)&&(a.route=this.createRoute(n.route,r.resolveRoute(),t,n.reloadOnSearch)),h(n.onEnter)&&this.transitions.onEnter(t,n.onEnter),h(n.onExit)&&this.transitions.onExit(t,n.onExit),h(n.children)&&$(n.children,function(t,n){a.add(a.fullname+"."+n,t)}),a},t}();t.StateFactory=n;var e=function(){function t(t,n,e){this._fullname=t,this._parent=e,this._children={},this._self=n,this._name=t.split(".").pop(),this._self.$fullname=t,this._reloadOnOptional=!h(n.reloadOnSearch)||n.reloadOnSearch}return Object.defineProperty(t.prototype,"fullname",{get:function(){return this._fullname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloadOnOptional",{get:function(){return this._reloadOnOptional},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"self",{get:function(){return b(this._self)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"route",{get:function(){return this._route},set:function(t){if(p(t))throw"Please supply time interval";this._route=t},enumerable:!0,configurable:!0}),t.prototype.add=function(t,n){return this._children[n.name]=n,this},t.prototype.resolveRoute=function(){return h(this.route)?this.route:h(this.parent)?this.parent.resolveRoute():""},t.prototype.internalLookup=function(t,n){var e=t.shift(),r=this._children[e],n=h(n)?n:0;if(p(r))throw"Could not locate '"+e+"' under '"+this.fullname+"'.";return t.length==n?r:r.internalLookup(t)},t.prototype.lookup=function(t,n){return"root"===t[0]&&t.shift(),this.internalLookup(t,n)},t}();t.StateClass=e})(t.routing||(t.routing={})),t.routing})(E||(E={})),angular.module("ui.routing").provider("$template",s),angular.module("ui.routing").provider("$view",f);var C=["$anchorScrollProvider",function(){this.$get=["$window","$rootScope","$location","$anchorScroll","$injector","$timeout",function(t,n,e,r,a,i){function u(t){t&&t.scrollIntoView()}function c(n){var e;p(n)?r():m(n)?"top"===n?t.scroll(0,0):u(angular.element(n)[0]):null!==(e=o(n))&&u(angular.element(a.invoke(n,e))[0])}return t.document,function(t){i(function(){c(t)},0)}}]}];angular.module("ui.routing").provider("$scroll",C);var O=["$state","$scroll","$compile","$controller","$view","$animator",function(t,n,e,r,a,o){return{restrict:"ECA",terminal:!0,link:function(t,n,i){function u(){s&&(s.$destroy(),s=null)}function c(t){t?v.leave(n.contents(),n):n.html(""),u()}function l(o){var i,u=a.get(f);if(u&&u.template){if(u.version===g)return;g=u.version,i=u.controller,u.template.then(function(a){c(o),o?v.enter(angular.element("<div></div>").html(a).contents(),n):n.html(a);var l,f=e(n.contents());s=t.$new(),i&&(l=b(u.locals),l.$scope=s,l.$async=function(){return function(){}},i=r(i,l),n.contents().data("$ngControllerController",i)),f(s),s.$emit("$viewContentLoaded"),s.$eval(m)})}else c(o)}var s,f=i.uiView||i.name,p=h(i.ngAnimate),m=i.onload||"",v=o(t,i),g=-1;t.$on("$viewChanged",function(t,n){n===f&&l(p)}),t.$on("$viewRefresh",function(t,n,e){n===f&&(d(s.refresh)?s.refresh(e):s.$broadcast("$refresh",n,e))}),t.$on("$stateChangeSuccess",function(){return l(p)}),l(!1)}}}];angular.module("ui.routing").directive("uiView",O)})(window,document);