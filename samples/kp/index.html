<!doctype html>
<html lang="en" ng-app="sample">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../bootstrap.min.css">
    <script src="../../lib/angular/impl/angular.js"></script>
    <script src="../../lib/angular/impl/angular-bootstrap.js"></script>
    <script src="../../lib/angular/impl/angular-bootstrap-prettify.js"></script>
    <script src="../../build/angular-routing.js"></script>
    <script src="../../build/angular-routing.legacy.js"></script>

    <!-- could easily use a custom property of the state here instead of 'name' -->
    <title ng-bind="$state.current.name + ' - angular-states'">angular-states</title>
</head>
<body>
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="#">ngStates</a>
                <ul class="nav">
                    <li ng-class="{ active: $state.includes('contacts') }"><a href="#/contacts">Contacts</a></li>
                    <li ng-class="{ active: $state.includes('about') }"><a href="#/about">About</a></li>
                </ul>
                <p class="navbar-text pull-right" ui-view="hint"></p>
            </div>
        </div>
    </div>
    <div class="container" style="margin-top: 60px" ui-view="main"></div>
    <hr>
    <pre>
  $state = {{$state.current.name}}
  $stateParams = {{$stateParams}}
</pre>
</body>
<script>

    function findById(a, id) {
        for (var i = 0; i < a.length; i++) {
            if (a[i].id == id) return a[i];
        }
    }

    angular.module('sample', ['ui.routing'])
      .config(
        ['$stateProvider',
        function ($stateProvider) {
            $stateProvider
              .state('home', {
                  route: '/',
                  views: {
                      'main': {
                          template: {
                              html: '<p class="lead">Welcome to the ngStates sample</p><p>Use the menu above to navigate</p>' +
                                    '<p>Look at <a href="#/c?id=1">Alice</a> or <a href="#/user/42">Bob</a> to see a URL with a redirect in action.</p>',
                          }
                      }
                  }
              })
              .state('contacts', {
                  route: '/contacts',
                  views: {
                      'main': {
                          template: '/samples/kp/contacts.html',
                          controller:
                            ['$scope', '$state',
                            function ($scope, $state) {
                                $scope.contacts = [{
                                    id: 1,
                                    name: "Alice",
                                    items: [{
                                        id: 'a',
                                        type: 'phone number',
                                        value: '555-1234-1234',
                                    }, {
                                        id: 'b',
                                        type: 'email',
                                        value: 'alice@mailinator.com',
                                    }],
                                }, {
                                    id: 42,
                                    name: "Bob",
                                    items: [{
                                        id: 'a',
                                        type: 'blog',
                                        value: 'http://bob.blogger.com',
                                    }, {
                                        id: 'b',
                                        type: 'fax',
                                        value: '555-999-9999',
                                    }],
                                }, {
                                    id: 123,
                                    name: "Eve",
                                    items: [{
                                        id: 'a',
                                        type: 'full name',
                                        value: 'Eve Adamsdottir',
                                    }],
                                }];

                                $scope.goToRandom = function () {
                                    var contacts = $scope.contacts, id;
                                    do {
                                        id = contacts[Math.floor(contacts.length * Math.random())].id;
                                    } while (id == $state.params.contactId);
                                    $state.goto('contacts.detail', { contactId: id });
                                };
                            }]
                      }
                  }
              })
              .state('contacts.detail', {
                  route: '/{num:id}',
                  views: {
                      'main': {
                          template: '/samples/kp/contacts.detail.html',
                          controller:
                            ['$scope',
                            function ($scope) {
                                $scope.contact = findById($scope.contacts);
                            }],
                      },
                      'hint': {
                          template: { html: 'This is contacts.detail populating the view "hint@"' }
                      },
                      'menu': {
                          template:
                            ['$stateParams',
                            function (/*$stateParams,*/) {
                                // This is just to demonstrate that $stateParams injection works for templateProvider
                                // $stateParams are the parameters for the new state we're transitioning to, even
                                // though the global '$stateParams' has not been updated yet.
                                return '<hr><small class="muted">Contact ID: ' + 1 + '</small>';
                            }],
                      },
                  },
              })
              .state('contacts.detail.item', {
                  route: '/item/:itemId',
                  views: {
                      'content': {
                          template: '/kp/contacts.detail.item.html',
                          controller:
                            ['$scope', '$state',
                            function ($scope, $state) {
                                $scope.item = findById($scope.contact.items, 1);
                                $scope.edit = function () {
                                    $state.transitionTo('contacts.detail.item.edit', 1);
                                };
                            }],
                      },
                      'hint': {
                          template: 'Overriding the view "hint@"',
                      },
                  }
              })
             .state('contacts.detail.item.edit', {
                 views: {
                     'contacts.detail': {
                         template: '/kp/contacts.detail.item.edit.html',
                         controller:
                           ['$scope', '$state',
                           function ($scope, $state) {
                               $scope.item = findById($scope.contact.items);
                               $scope.done = function () {
                                   $state.transitionTo('contacts.detail.item');
                               };
                           }],
                     },
                 },
             })
              .state('about', {
                  route: '/about',
                  template:
                    ['$timeout',
                    function ($timeout) {
                        return $timeout(function () { return "Hello world"; }, 100);
                    }],
              });
        }])
</script>
</html>
